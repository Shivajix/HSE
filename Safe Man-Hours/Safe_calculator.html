<!DOCTYPE html>
<html lang="en">
<head>
	<script type='text/javascript' src='//pl27925970.effectivegatecpm.com/31/af/3e/31af3e48e6897c232179bf9508903603.js'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safe Man-Hours Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #2c5aa0;
            --primary-dark: #1e3d72;
            --secondary: #4caf50;
            --secondary-dark: #388e3c;
            --danger: #f44336;
            --warning: #ff9800;
            --info: #2196f3;
            --light: #f5f7fa;
            --dark: #333;
            --gray: #6c757d;
            --border: #dee2e6;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header - Auto Adjust */
        header {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 250px;
        }
        
        .logo-icon {
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .logo-text h1 {
            font-size: clamp(20px, 4vw, 28px);
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .logo-text p {
            color: var(--gray);
            font-size: clamp(12px, 2vw, 14px);
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        /* Buttons - Auto Adjust */
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-success {
            background: var(--secondary);
            color: white;
        }
        
        .btn-success:hover {
            background: var(--secondary-dark);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-back {
            background: var(--gray);
            color: white;
        }
        
        /* Card Container - Auto Adjust Grid */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 350px), 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            height: fit-content;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .card-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .card-title {
            font-size: clamp(16px, 3vw, 20px);
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Form Elements - Auto Adjust */
        .form-group {
            margin-bottom: 18px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }
        
        /* Form Grid - Auto Adjust */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 200px), 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        /* LTI Options - Auto Adjust */
        .lti-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .lti-option {
            text-align: center;
        }
        
        .lti-option input {
            display: none;
        }
        
        .lti-option label {
            display: block;
            padding: 12px 8px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 13px;
        }
        
        .lti-option input:checked + label {
            border-color: var(--primary);
            background: rgba(44, 90, 160, 0.1);
            color: var(--primary);
        }
        
        .lti-option label:hover {
            border-color: var(--primary);
        }
        
        /* Workforce Card - Full Width */
        .workforce-card {
            grid-column: 1 / -1;
        }
        
        .workforce-container {
            overflow-x: auto;
        }
        
        .workforce-table {
            width: 100%;
            min-width: 700px;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .workforce-table th {
            background: var(--primary);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        
        .workforce-table td {
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .workforce-table input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .remove-btn {
            color: var(--danger);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: color 0.3s;
            padding: 5px;
        }
        
        .remove-btn:hover {
            color: #b71c1c;
        }
        
        .tip {
            background-color: #f8f9fa;
            padding: 12px 15px;
            border-radius: 6px;
            font-size: 13px;
            color: var(--gray);
            margin-top: 15px;
            border-left: 4px solid var(--info);
        }
        
        /* Template Section - Auto Adjust */
        .template-section {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: end;
            margin-bottom: 15px;
        }
        
        .milestones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 200px), 1fr));
            gap: 15px;
        }
        
        .footer-note {
            margin-top: 25px;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--gray);
            text-align: center;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        /* Popup Preview - Auto Adjust */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .popup-content {
            background: white;
            width: 100%;
            max-width: min(95%, 900px);
            max-height: 90vh;
            border-radius: 8px;
            overflow-y: auto;
            padding: 25px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .popup-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s;
        }
        
        .popup-close:hover {
            color: var(--dark);
        }
        
        .popup-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* A4 Preview - Auto Adjust */
        .a4-preview {
            width: 100%;
            max-width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border: 1px solid #ccc;
        }
        
        .a4-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
        }
        
        .a4-header h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: clamp(20px, 4vw, 24px);
        }
        
        .a4-date {
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
        }
        
        .a4-section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #fafbfc;
        }
        
        .a4-section h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            font-size: clamp(16px, 3vw, 18px);
        }
        
        .a4-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .a4-box {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .a4-box h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .a4-box .value {
            font-size: clamp(20px, 4vw, 24px);
            font-weight: bold;
            color: var(--secondary);
        }
        
        /* Preview Tables - Auto Adjust */
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: clamp(10px, 2vw, 12px);
            border: 1px solid var(--dark);
        }
        
        .preview-table th {
            background: var(--primary);
            color: white;
            padding: 10px 8px;
            text-align: center;
            border: 1px solid var(--dark);
            font-weight: 600;
        }
        
        .preview-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid var(--dark);
        }
        
        .preview-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .project-info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border: 1px solid var(--dark);
            font-size: clamp(11px, 2vw, 13px);
        }
        
        .project-info-table th, .project-info-table td {
            padding: 10px;
            border: 1px solid var(--dark);
            text-align: left;
        }
        
        .project-info-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            width: 30%;
        }
        
        .project-info-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .preview-list {
            list-style-type: none;
            margin: 15px 0;
        }
        
        .preview-list li {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .preview-list li:before {
            content: "•";
            color: var(--secondary);
            font-size: 20px;
        }
        
        /* Mobile-First Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header {
                padding: 15px;
                text-align: center;
                flex-direction: column;
            }
            
            .logo {
                justify-content: center;
                text-align: center;
            }
            
            .header-actions {
                justify-content: center;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .card {
                padding: 15px;
            }
            
            .card-header {
                flex-direction: column;
                text-align: center;
            }
            
            .card-icon {
                margin: 0 auto;
            }
            
            .template-section {
                grid-template-columns: 1fr;
            }
            
            .workforce-table {
                min-width: 600px;
            }
            
            .a4-preview {
                padding: 10mm;
            }
            
            .popup-content {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .popup-actions {
                flex-direction: column;
            }
            
            .a4-preview {
                padding: 8mm;
            }
            
            .preview-table, .project-info-table {
                font-size: 10px;
            }
            
            .preview-table th, .preview-table td,
            .project-info-table th, .project-info-table td {
                padding: 6px 4px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .milestones-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 1200px) {
            .card-container {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .workforce-card {
                grid-column: span 3;
            }
        }
        
        @media (min-width: 1600px) {
            .card-container {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .workforce-card {
                grid-column: span 4;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-hard-hat"></i>
                </div>
                <div class="logo-text">
                    <h1>Safe Man-Hours Calculator</h1>
                    <p>Fill details, apply a template, preview, and export to PDF</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-back">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
            </div>
        </header>
        <script type="text/javascript">
	atOptions = {
		'key' : '8c583ba0dcd1a7e997879d6e5d0ed0fc',
		'format' : 'iframe',
		'height' : 250,
		'width' : 300,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/8c583ba0dcd1a7e997879d6e5d0ed0fc/invoke.js"></script>
        <div class="card-container">
            <!-- Project Details Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #e3f2fd; color: #1976d2;">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <h2 class="card-title">Project / Site Details</h2>
                </div>
                <div class="form-group">
                    <label for="projectName">Project / Site Name</label>
                    <input type="text" id="projectName" placeholder="e.g., Greenfield Refinery Expansion">
                </div>
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" placeholder="City, Country">
                </div>
                <div class="form-group">
                    <label for="client">Client / Company</label>
                    <input type="text" id="client" placeholder="e.g., ABC Energy Pvt. Ltd.">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="periodFrom">Reporting Period (From)</label>
                        <input type="date" id="periodFrom">
                    </div>
                    <div class="form-group">
                        <label for="periodTo">Reporting Period (To)</label>
                        <input type="date" id="periodTo">
                    </div>
                </div>
                <div class="form-group">
                    <label>LTI Occurred?</label>
                    <div class="lti-options">
                        <div class="lti-option">
                            <input type="radio" id="lti-no" name="lti" value="no" checked>
                            <label for="lti-no">No (Counter continues)</label>
                        </div>
                        <div class="lti-option">
                            <input type="radio" id="lti-yes" name="lti" value="yes">
                            <label for="lti-yes">Yes (Reset counter)</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Workforce & Hours Card -->
            <div class="card workforce-card">
                <div class="card-header">
                    <div class="card-icon" style="background: #e8f5e9; color: #388e3c;">
                        <i class="fas fa-users"></i>
                    </div>
                    <h2 class="card-title">Workforce & Hours</h2>
                </div>
                
                <div class="workforce-container">
                    <table class="workforce-table">
                        <thead>
                            <tr>
                                <th>Category / Crew</th>
                                <th># Workers</th>
                                <th>Hours/Day</th>
                                <th>Days (No LTI)</th>
                                <th>OT Hours/Day</th>
                                <th>Shifts/Day</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="workforceTableBody">
                            <tr>
                                <td><input type="text" class="crew-input" value="General Workforce" placeholder="Category/Crew"></td>
                                <td><input type="number" class="workers-input" value="100" placeholder="Workers"></td>
                                <td><input type="number" class="hours-input" value="8" placeholder="Hours"></td>
                                <td><input type="number" class="days-input" value="26" placeholder="Days"></td>
                                <td><input type="number" class="ot-input" value="0" placeholder="OT Hours"></td>
                                <td><input type="number" class="shifts-input" value="1" placeholder="Shifts"></td>
                                <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <button class="btn btn-success" id="addRowBtn">
                    <i class="fas fa-plus"></i> Add Row
                </button>
                <div class="tip">
                    Tip: Use separate rows for staff vs. contractors or different shift patterns.
                </div>
            </div>
            
            <!-- Templates Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #fff3e0; color: #f57c00;">
                        <i class="fas fa-clone"></i>
                    </div>
                    <h2 class="card-title">Templates</h2>
                </div>
                <div class="template-section">
                    <div class="form-group">
                        <label for="templateSelect">Select a Template</label>
                        <select id="templateSelect">
                            <option>– Choose –</option>
                            <option>Construction Template</option>
                            <option>Manufacturing Template</option>
                            <option>Oil & Gas Template</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="applyTemplateBtn">
                        <i class="fas fa-check"></i> Apply Template
                    </button>
                </div>
                <div class="tip">
                    Applying a template will auto-fill all sections (project info + workforce rows).
                </div>
            </div>
            
            <!-- Milestones & Notes Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #f3e5f5; color: #7b1fa2;">
                        <i class="fas fa-flag-checkered"></i>
                    </div>
                    <h2 class="card-title">Milestones & Notes</h2>
                </div>
                <div class="milestones-grid">
                    <div class="form-group">
                        <label for="previousHours">Previous Safe Man-Hours (carry-over)</label>
                        <input type="text" id="previousHours" placeholder="e.g., 980000">
                    </div>
                    <div class="form-group">
                        <label for="cumulativeHours">Cumulative Safe Man-Hours</label>
                        <input type="text" id="cumulativeHours" placeholder="Auto-calculated" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label for="highlights">Highlights / Remarks</label>
                    <textarea id="highlights" rows="4" placeholder="Key highlights, toolbox talks, audits, observations..."></textarea>
                </div>
            </div>
        </div>
        
        <!-- Actions Card -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon" style="background: #e1f5fe; color: #0288d1;">
                    <i class="fas fa-cogs"></i>
                </div>
                <h2 class="card-title">Actions</h2>
            </div>
            <div class="form-grid">
                <button class="btn btn-primary" id="previewBtn">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button class="btn btn-success" id="downloadBtn">
                    <i class="fas fa-download"></i> Download PDF
                </button>
                <button class="btn btn-danger" id="resetBtn">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
        </div>
        
        <div class="footer-note">
            If LTI occurred = Yes, the counter since last LTI section resets to 0. Employee hours software Safety Training Courses
        </div>
    </div>

    <!-- Popup Preview -->
    <div class="popup-overlay" id="previewPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h1>Safe Man-Hours Report</h1>
                <button class="popup-close" id="closePopup">&times;</button>
            </div>
            
            <!-- A4 Preview Content -->
            <div class="a4-preview" id="a4Preview">
                <div class="a4-header">
                    <h1>Safe Man-Hours Report</h1>
                    <p>Generated preview — review and export to PDF</p>
                    <div class="a4-date" id="previewDate"></div>
                </div>
                
                <div class="a4-section">
                    <h2>Project Information</h2>
                    <table class="project-info-table">
                        <tr>
                            <th>Project / Site</th>
                            <td id="previewProject">--</td>
                        </tr>
                        <tr>
                            <th>Client</th>
                            <td id="previewClient">--</td>
                        </tr>
                        <tr>
                            <th>Location</th>
                            <td id="previewLocation">--</td>
                        </tr>
                        <tr>
                            <th>Reporting Period</th>
                            <td id="previewPeriod">--</td>
                        </tr>
                        <tr>
                            <th>LTI Occurred</th>
                            <td id="previewLTI">No</td>
                        </tr>
                    </table>
                </div>
                
                <div class="a4-section">
                    <h2>Workforce & Hours Summary</h2>
                    <table class="preview-table" id="previewWorkforceTable">
                        <thead>
                            <tr>
                                <th>Category / Crew</th>
                                <th># Workers</th>
                                <th>Hours/Day</th>
                                <th>Days (No LTI)</th>
                                <th>OT Hours/Day</th>
                                <th>Shifts/Day</th>
                                <th>Total Hours</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6" style="text-align: right; font-weight: bold;">Subtotal (This Period):</td>
                                <td style="font-weight: bold;" id="previewSubtotal">0</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div class="a4-grid">
                    <div class="a4-box">
                        <h3>SAFE MAN-HOURS (THIS PERIOD)</h3>
                        <div class="value" id="previewSafeHours">0</div>
                    </div>
                    <div class="a4-box">
                        <h3>CARRY-OVER (BEFORE PERIOD)</h3>
                        <div class="value" id="previewCarryOver">0</div>
                    </div>
                    <div class="a4-box">
                        <h3>CUMULATIVE SAFE MAN-HOURS</h3>
                        <div class="value" id="previewCumulative">0</div>
                    </div>
                </div>
                
                <div class="a4-section">
                    <h2>Milestones</h2>
                    <ul class="preview-list" id="previewMilestones">
                        <!-- Will be populated by JavaScript -->
                    </ul>
                </div>
                
                <div class="a4-section">
                    <h2>Highlights / Remarks</h2>
                    <p id="previewHighlights">- Generated by The HSE Tools – Safe Man-Hours Calculator</p>
                </div>
            </div>
            
            <div class="popup-actions">
                <button class="btn btn-success" id="downloadFromPopup">
                    <i class="fas fa-download"></i> Download PDF
                </button>
                <button class="btn btn-outline" id="closePopupBtn">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Set current date for preview
        document.getElementById('previewDate').textContent = new Date().toLocaleString();
        
        // Add Row functionality
        document.getElementById('addRowBtn').addEventListener('click', function() {
            const tableBody = document.getElementById('workforceTableBody');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td><input type="text" class="crew-input" placeholder="Category/Crew"></td>
                <td><input type="number" class="workers-input" value="0" placeholder="Workers"></td>
                <td><input type="number" class="hours-input" value="8" placeholder="Hours"></td>
                <td><input type="number" class="days-input" value="0" placeholder="Days"></td>
                <td><input type="number" class="ot-input" value="0" placeholder="OT Hours"></td>
                <td><input type="number" class="shifts-input" value="1" placeholder="Shifts"></td>
                <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
            `;
            
            tableBody.appendChild(newRow);
            
            // Add event listener to the new remove button
            newRow.querySelector('.remove-btn').addEventListener('click', function() {
                tableBody.removeChild(newRow);
                updateCumulativeHours();
            });
            
            // Add event listeners to inputs for auto-calculation
            const inputs = newRow.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', updateCumulativeHours);
            });
        });
        
        // Add event listeners to existing remove buttons
        document.querySelectorAll('.remove-btn').forEach(button => {
            button.addEventListener('click', function() {
                const row = this.closest('tr');
                row.parentNode.removeChild(row);
                updateCumulativeHours();
            });
        });
        
        // Add event listeners to inputs for auto-calculation
        document.querySelectorAll('#workforceTableBody input').forEach(input => {
            input.addEventListener('input', updateCumulativeHours);
        });
        
        // Apply Template functionality
        document.getElementById('applyTemplateBtn').addEventListener('click', function() {
            const template = document.getElementById('templateSelect').value;
            if (template !== '– Choose –') {
                alert(`Applying ${template}...`);
                // In a real application, this would populate the form with template data
                if (template === 'Construction Template') {
                    document.getElementById('projectName').value = 'Commercial Building Construction';
                    document.getElementById('location').value = 'New York, USA';
                    document.getElementById('client').value = 'ABC Construction Inc.';
                } else if (template === 'Manufacturing Template') {
                    document.getElementById('projectName').value = 'Automotive Parts Manufacturing';
                    document.getElementById('location').value = 'Detroit, USA';
                    document.getElementById('client').value = 'XYZ Automotive Ltd.';
                }
                updateCumulativeHours();
            } else {
                alert('Please select a template first.');
            }
        });
        
        // Calculate cumulative hours
        function updateCumulativeHours() {
            const rows = document.querySelectorAll('#workforceTableBody tr');
            let totalHours = 0;
            
            rows.forEach(row => {
                const workers = parseInt(row.querySelector('.workers-input').value) || 0;
                const hours = parseInt(row.querySelector('.hours-input').value) || 0;
                const days = parseInt(row.querySelector('.days-input').value) || 0;
                const ot = parseInt(row.querySelector('.ot-input').value) || 0;
                const shifts = parseInt(row.querySelector('.shifts-input').value) || 1;
                
                const rowHours = workers * (hours + ot) * days * shifts;
                totalHours += rowHours;
            });
            
            const previousHours = parseInt(document.getElementById('previousHours').value) || 0;
            const cumulativeHours = totalHours + previousHours;
            
            document.getElementById('cumulativeHours').value = cumulativeHours.toLocaleString();
        }
        
        // Preview functionality
        function updatePreview() {
            // Update project details
            document.getElementById('previewProject').textContent = 
                document.getElementById('projectName').value || '--';
            document.getElementById('previewClient').textContent = 
                document.getElementById('client').value || '--';
            document.getElementById('previewLocation').textContent = 
                document.getElementById('location').value || '--';
            
            // Update period
            const from = document.getElementById('periodFrom').value;
            const to = document.getElementById('periodTo').value;
            document.getElementById('previewPeriod').textContent = 
                (from && to) ? `${from} to ${to}` : '--';
            
            // Update LTI status
            const ltiYes = document.getElementById('lti-yes').checked;
            document.getElementById('previewLTI').textContent = ltiYes ? 'Yes' : 'No';
            
            // Update workforce table in preview
            const previewTable = document.getElementById('previewWorkforceTable').getElementsByTagName('tbody')[0];
            previewTable.innerHTML = '';
            
            const rows = document.querySelectorAll('#workforceTableBody tr');
            let totalHours = 0;
            
            rows.forEach(row => {
                const crew = row.querySelector('.crew-input').value || '--';
                const workers = parseInt(row.querySelector('.workers-input').value) || 0;
                const hours = parseInt(row.querySelector('.hours-input').value) || 0;
                const days = parseInt(row.querySelector('.days-input').value) || 0;
                const ot = parseInt(row.querySelector('.ot-input').value) || 0;
                const shifts = parseInt(row.querySelector('.shifts-input').value) || 1;
                
                const rowHours = workers * (hours + ot) * days * shifts;
                totalHours += rowHours;
                
                const newRow = previewTable.insertRow();
                newRow.innerHTML = `
                    <td>${crew}</td>
                    <td>${workers}</td>
                    <td>${hours}</td>
                    <td>${days}</td>
                    <td>${ot}</td>
                    <td>${shifts}</td>
                    <td>${rowHours.toLocaleString()}</td>
                `;
            });
            
            // Update totals
            document.getElementById('previewSubtotal').textContent = totalHours.toLocaleString();
            document.getElementById('previewSafeHours').textContent = totalHours.toLocaleString();
            
            // Update carry-over and cumulative
            const previousHours = parseInt(document.getElementById('previousHours').value) || 0;
            document.getElementById('previewCarryOver').textContent = previousHours.toLocaleString();
            document.getElementById('previewCumulative').textContent = (totalHours + previousHours).toLocaleString();
            
            // Update milestones
            const milestonesList = document.getElementById('previewMilestones');
            milestonesList.innerHTML = '';
            
            if (totalHours >= 10000) {
                const milestone = document.createElement('li');
                milestone.textContent = 'Achieved 10,000 Safe Man-Hours without LTI';
                milestonesList.appendChild(milestone);
            }
            
            if (totalHours >= 50000) {
                const milestone = document.createElement('li');
                milestone.textContent = 'Achieved 50,000 Safe Man-Hours without LTI';
                milestonesList.appendChild(milestone);
            }
            
            // Update highlights
            const highlights = document.getElementById('highlights').value;
            document.getElementById('previewHighlights').textContent = 
                highlights || '- Generated by The HSE Tools – Safe Man-Hours Calculator';
        }
        
        // Popup functionality
        function openPopup() {
            updatePreview();
            document.getElementById('previewPopup').style.display = 'flex';
        }
        
        function closePopup() {
            document.getElementById('previewPopup').style.display = 'none';
        }
        
        // Add event listeners for preview buttons
        document.getElementById('previewBtn').addEventListener('click', openPopup);
        
        // Close popup events
        document.getElementById('closePopup').addEventListener('click', closePopup);
        document.getElementById('closePopupBtn').addEventListener('click', closePopup);
        
        // Close popup when clicking outside
        document.getElementById('previewPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                closePopup();
            }
        });
        
        // PDF Download functionality
        function downloadPDF() {
            updatePreview();
            const element = document.getElementById('a4Preview');
            
            // Options for PDF generation
            const options = {
                margin: 10,
                filename: 'safe-man-hours-report.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            // Generate PDF
            html2pdf().from(element).set(options).save();
        }
        
        // Add event listeners for download buttons
        document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
        document.getElementById('downloadFromPopup').addEventListener('click', downloadPDF);
        
        // Reset functionality
        function resetForm() {
            document.querySelectorAll('input, textarea, select').forEach(element => {
                if (element.type !== 'button' && element.type !== 'submit') {
                    element.value = '';
                }
            });
            
            // Reset LTI to No
            document.getElementById('lti-no').checked = true;
            
            // Reset workforce table to one row
            const tableBody = document.getElementById('workforceTableBody');
            tableBody.innerHTML = `
                <tr>
                    <td><input type="text" class="crew-input" value="General Workforce" placeholder="Category/Crew"></td>
                    <td><input type="number" class="workers-input" value="100" placeholder="Workers"></td>
                    <td><input type="number" class="hours-input" value="8" placeholder="Hours"></td>
                    <td><input type="number" class="days-input" value="26" placeholder="Days"></td>
                    <td><input type="number" class="ot-input" value="0" placeholder="OT Hours"></td>
                    <td><input type="number" class="shifts-input" value="1" placeholder="Shifts"></td>
                    <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
                </tr>
            `;
            
            // Reattach event listener to the remove button
            document.querySelector('.remove-btn').addEventListener('click', function() {
                const row = this.closest('tr');
                row.parentNode.removeChild(row);
                updateCumulativeHours();
            });
            
            // Reattach event listeners to inputs
            document.querySelectorAll('#workforceTableBody input').forEach(input => {
                input.addEventListener('input', updateCumulativeHours);
            });
            
            updateCumulativeHours();
            updatePreview();
        }
        
        document.getElementById('resetBtn').addEventListener('click', resetForm);
        
        // Initialize cumulative hours on page load
        updateCumulativeHours();
    </script>
</body>
</html>