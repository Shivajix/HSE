<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Safety Report Generator</title>
    <meta name="description" content="Generate comprehensive weekly safety reports for construction and industrial sites">
    <meta name="keywords" content="weekly safety report, construction safety, OSHA compliance, safety management">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
            --dark: #34495e;
            --light: #ecf0f1;
            --bg-color: #f5f7fa;
            --text-color: #2c3e50;
            --card-bg: #ffffff;
            --border-color: #ddd;
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #f0f0f0;
            --card-bg: #2d2d2d;
            --border-color: #444;
            --primary: #3498db;
            --dark: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out;
            position: relative;
        }

        h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .subtitle {
            color: var(--dark);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-info {
            background-color: var(--info);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .section {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 25px;
            animation: slideUp 0.5s ease-out;
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        .section-title i {
            margin-right: 10px;
            color: var(--secondary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s ease;
            background: var(--card-bg);
            color: var(--text-color);
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: rgba(0,0,0,0.03);
        }

        tr:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .add-row-btn {
            margin: 10px 0;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input {
            width: auto;
        }

        .preview-section {
            background: var(--bg-color);
            border: 2px dashed var(--border-color);
        }

        .preview-content {
            padding: 20px;
            background: var(--card-bg);
            border-radius: 8px;
            margin-top: 15px;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .preview-table th, .preview-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }

        .preview-table th {
            background-color: var(--primary);
            color: white;
        }

        .preview-table tr:nth-child(even) {
            background-color: rgba(0,0,0,0.03);
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .rating-group {
            display: flex;
            gap: 20px;
            margin: 15px 0;
        }

        .rating-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rating-item input {
            width: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .language-selector {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .theme-toggle {
            position: absolute;
            top: 10px;
            left: 10px;
        }

        .status-saved {
            color: var(--success);
            font-weight: bold;
            margin-left: 10px;
        }

        .preview-section-title {
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
            color: var(--primary);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .control-buttons {
                flex-direction: column;
                align-items: center;
            }

            .language-selector, .theme-toggle {
                position: static;
                margin-bottom: 10px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .rating-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="theme-toggle">
                <button class="btn btn-info" id="themeToggle">
                    <i class="fas fa-moon"></i> <span class="theme-text">Dark Mode</span>
                </button>
            </div>
            <h1 class="title-text">Weekly Safety Report Generator</h1>
            <p class="subtitle subtitle-text">Comprehensive weekly safety reporting for construction and industrial sites</p>
            <div class="language-selector">
                <button class="btn btn-primary" id="translateBtn">
                    <i class="fas fa-language"></i> <span class="translate-text">Translate to Hindi</span>
                </button>
            </div>
        </header>

        <div class="control-buttons">
            <button class="btn btn-primary" id="previewBtn">
                <i class="fas fa-eye"></i> <span class="preview-text">Preview Report</span>
            </button>
            <button class="btn btn-success" id="downloadBtn">
                <i class="fas fa-file-pdf"></i> <span class="download-text">Download PDF</span>
            </button>
            <button class="btn btn-warning" id="saveBtn">
                <i class="fas fa-save"></i> <span class="save-text">Save Draft</span>
            </button>
            <button class="btn btn-danger" id="resetBtn">
                <i class="fas fa-sync-alt"></i> <span class="reset-text">Reset Form</span>
            </button>
        </div>

        <!-- Section 1: Report Details -->
        <div class="section" id="reportDetails">
            <h2 class="section-title"><i class="fas fa-clipboard-list"></i> <span class="details-text">Report Details</span></h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="siteName" class="site-text">Project / Site Name *</label>
                    <input type="text" id="siteName" placeholder="e.g., ABC Refinery – Unit 3" required>
                </div>
                
                <div class="form-group">
                    <label for="location" class="location-text">Location *</label>
                    <input type="text" id="location" placeholder="e.g., Tank Farm – Bay 2" required>
                </div>
                
                <div class="form-group">
                    <label for="weekFrom" class="week-from-text">Week From *</label>
                    <input type="date" id="weekFrom" required>
                </div>
                
                <div class="form-group">
                    <label for="weekTo" class="week-to-text">Week To *</label>
                    <input type="date" id="weekTo" required>
                </div>
                
                <div class="form-group">
                    <label for="preparedBy" class="prepared-text">Prepared By *</label>
                    <input type="text" id="preparedBy" placeholder="Your name" required>
                </div>
                
                <div class="form-group">
                    <label for="submissionDate" class="submission-text">Date of Submission *</label>
                    <input type="date" id="submissionDate" required>
                </div>
            </div>
        </div>

        <!-- Section 2: Manpower Summary -->
        <div class="section" id="manpowerSummary">
            <h2 class="section-title"><i class="fas fa-users"></i> <span class="manpower-text">Manpower Summary (Min / Max / Avg)</span></h2>
            
            <button class="btn btn-primary add-row-btn" id="addManpowerRow">
                <i class="fas fa-plus"></i> <span class="add-row-text">Add Row</span>
            </button>
            
            <div class="table-container">
                <table id="manpowerTable">
                    <thead>
                        <tr>
                            <th class="category-text">Category</th>
                            <th class="minimum-text">Minimum</th>
                            <th class="maximum-text">Maximum</th>
                            <th class="average-text">Average</th>
                            <th class="actions-text">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="manpowerTableBody">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section 3: Key Work Activities -->
        <div class="section" id="workActivities">
            <h2 class="section-title"><i class="fas fa-tasks"></i> <span class="activities-text">Key Work Activities (Weekly)</span></h2>
            
            <button class="btn btn-primary add-row-btn" id="addActivityRow">
                <i class="fas fa-plus"></i> <span class="add-row-text">Add Row</span>
            </button>
            
            <div class="table-container">
                <table id="activitiesTable">
                    <thead>
                        <tr>
                            <th class="activity-text">Activity Description</th>
                            <th class="location-text">Location</th>
                            <th class="status-text">Status / Remarks</th>
                            <th class="actions-text">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="activitiesTableBody">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section 4: Permits Issued -->
        <div class="section" id="permitsSection">
            <h2 class="section-title"><i class="fas fa-file-signature"></i> <span class="permits-text">Permits Issued (Weekly Summary)</span></h2>
            
            <button class="btn btn-primary add-row-btn" id="addPermitRow">
                <i class="fas fa-plus"></i> <span class="add-row-text">Add Row</span>
            </button>
            
            <div class="table-container">
                <table id="permitsTable">
                    <thead>
                        <tr>
                            <th class="type-text">Type of Permit</th>
                            <th class="total-text">Total Issued</th>
                            <th class="renewed-text">Renewed</th>
                            <th class="actions-text">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="permitsTableBody">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section 5: Safety Observations -->
        <div class="section" id="safetyObservations">
            <h2 class="section-title"><i class="fas fa-binoculars"></i> <span class="observations-text">Safety Observations / Findings</span></h2>
            
            <button class="btn btn-primary add-row-btn" id="addObservationRow">
                <i class="fas fa-plus"></i> <span class="add-row-text">Add Row</span>
            </button>
            
            <div class="table-container">
                <table id="observationsTable">
                    <thead>
                        <tr>
                            <th class="unsafe-text">Unsafe Act/Condition</th>
                            <th class="corrective-text">Corrective Action</th>
                            <th class="status-text">Status</th>
                            <th class="actions-text">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="observationsTableBody">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section 6: Incidents & Near Misses -->
        <div class="section" id="incidentsSection">
            <h2 class="section-title"><i class="fas fa-exclamation-triangle"></i> <span class="incidents-text">Incidents / Near Misses</span></h2>
            
            <button class="btn btn-primary add-row-btn" id="addIncidentRow">
                <i class="fas fa-plus"></i> <span class="add-row-text">Add Row</span>
            </button>
            
            <div class="table-container">
                <table id="incidentsTable">
                    <thead>
                        <tr>
                            <th class="date-text">Date</th>
                            <th class="type-text">Type</th>
                            <th class="description-text">Description</th>
                            <th class="root-text">Root Cause</th>
                            <th class="action-text">Action Taken</th>
                            <th class="actions-text">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="incidentsTableBody">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section 7: Safety Training -->
        <div class="section" id="safetyTraining">
            <h2 class="section-title"><i class="fas fa-chalkboard-teacher"></i> <span class="training-text">Safety Training & Toolbox Talks</span></h2>
            
            <button class="btn btn-primary add-row-btn" id="addTrainingRow">
                <i class="fas fa-plus"></i> <span class="add-row-text">Add Row</span>
            </button>
            
            <div class="table-container">
                <table id="trainingTable">
                    <thead>
                        <tr>
                            <th class="date-text">Date</th>
                            <th class="topic-text">Topic</th>
                            <th class="conducted-text">Conducted By</th>
                            <th class="participants-text">Participants</th>
                            <th class="remarks-text">Remarks</th>
                            <th class="actions-text">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trainingTableBody">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section 8: Additional Information -->
        <div class="section" id="additionalInfo">
            <h2 class="section-title"><i class="fas fa-info-circle"></i> <span class="additional-text">Additional Information</span></h2>
            
            <div class="form-group">
                <label for="housekeeping" class="housekeeping-text">Housekeeping & Welfare</label>
                <textarea id="housekeeping" placeholder="Describe housekeeping and welfare conditions"></textarea>
            </div>
            
            <div class="form-group">
                <label for="highlights" class="highlights-text">Highlights & Improvements (This Week)</label>
                <textarea id="highlights" placeholder="Key highlights and improvements"></textarea>
            </div>
            
            <div class="form-group">
                <label for="challenges" class="challenges-text">Challenges & Pending Issues</label>
                <textarea id="challenges" placeholder="Current challenges and pending issues"></textarea>
            </div>
            
            <div class="form-group">
                <label class="summary-text">Summary Rating</label>
                <div class="rating-group">
                    <div class="rating-item">
                        <input type="radio" id="excellent" name="rating" value="excellent">
                        <label for="excellent" class="excellent-text">Excellent</label>
                    </div>
                    <div class="rating-item">
                        <input type="radio" id="satisfactory" name="rating" value="satisfactory" checked>
                        <label for="satisfactory" class="satisfactory-text">Satisfactory</label>
                    </div>
                    <div class="rating-item">
                        <input type="radio" id="needsImprovement" name="rating" value="needsImprovement">
                        <label for="needsImprovement" class="improvement-text">Needs Improvement</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 9: Preview -->
        <div class="section preview-section" id="previewSection">
            <h2 class="section-title"><i class="fas fa-eye"></i> <span class="preview-text">Live Preview</span></h2>
            
            <div class="preview-content" id="previewContent">
                <p class="preview-instruction-text">Click Preview to generate.</p>
            </div>
        </div>

        <!-- Section 10: Action Buttons -->
        <div class="actions">
            <button class="btn btn-success" id="finalDownloadBtn">
                <i class="fas fa-file-pdf"></i> <span class="download-text">Download PDF</span>
            </button>
            <button class="btn btn-danger" id="finalResetBtn">
                <i class="fas fa-sync-alt"></i> <span class="clear-text">Clear All</span>
            </button>
            <span class="status-saved autosave-text">Auto-saved</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay()); // Start of week (Sunday)
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6); // End of week (Saturday)
            
            document.getElementById('weekFrom').value = weekStart.toISOString().split('T')[0];
            document.getElementById('weekTo').value = weekEnd.toISOString().split('T')[0];
            document.getElementById('submissionDate').value = today.toISOString().split('T')[0];

            // Translation functionality
            const translateBtn = document.getElementById('translateBtn');
            let isHindi = false;
            
            const translations = {
                en: {
                    themeText: "Dark Mode",
                    titleText: "Weekly Safety Report Generator",
                    subtitleText: "Comprehensive weekly safety reporting for construction and industrial sites",
                    translateText: "Translate to Hindi",
                    previewText: "Preview Report",
                    downloadText: "Download PDF",
                    saveText: "Save Draft",
                    resetText: "Reset Form",
                    detailsText: "Report Details",
                    siteText: "Project / Site Name *",
                    locationText: "Location *",
                    weekFromText: "Week From *",
                    weekToText: "Week To *",
                    preparedText: "Prepared By *",
                    submissionText: "Date of Submission *",
                    manpowerText: "Manpower Summary (Min / Max / Avg)",
                    addRowText: "Add Row",
                    categoryText: "Category",
                    minimumText: "Minimum",
                    maximumText: "Maximum",
                    averageText: "Average",
                    actionsText: "Actions",
                    activitiesText: "Key Work Activities (Weekly)",
                    activityText: "Activity Description",
                    statusText: "Status / Remarks",
                    permitsText: "Permits Issued (Weekly Summary)",
                    typeText: "Type of Permit",
                    totalText: "Total Issued",
                    renewedText: "Renewed",
                    observationsText: "Safety Observations / Findings",
                    unsafeText: "Unsafe Act/Condition",
                    correctiveText: "Corrective Action",
                    incidentsText: "Incidents / Near Misses",
                    dateText: "Date",
                    descriptionText: "Description",
                    rootText: "Root Cause",
                    actionText: "Action Taken",
                    trainingText: "Safety Training & Toolbox Talks",
                    topicText: "Topic",
                    conductedText: "Conducted By",
                    participantsText: "Participants",
                    remarksText: "Remarks",
                    additionalText: "Additional Information",
                    housekeepingText: "Housekeeping & Welfare",
                    highlightsText: "Highlights & Improvements (This Week)",
                    challengesText: "Challenges & Pending Issues",
                    summaryText: "Summary Rating",
                    excellentText: "Excellent",
                    satisfactoryText: "Satisfactory",
                    improvementText: "Needs Improvement",
                    previewInstructionText: "Click Preview to generate.",
                    clearText: "Clear All",
                    autosaveText: "Auto-saved"
                },
                hi: {
                    themeText: "डार्क मोड",
                    titleText: "साप्ताहिक सुरक्षा रिपोर्ट जनरेटर",
                    subtitleText: "निर्माण और औद्योगिक स्थलों के लिए व्यापक साप्ताहिक सुरक्षा रिपोर्टिंग",
                    translateText: "अंग्रेजी में अनुवाद करें",
                    previewText: "रिपोर्ट पूर्वावलोकन",
                    downloadText: "PDF डाउनलोड करें",
                    saveText: "ड्राफ्ट सहेजें",
                    resetText: "फॉर्म रीसेट करें",
                    detailsText: "रिपोर्ट विवरण",
                    siteText: "परियोजना / साइट का नाम *",
                    locationText: "स्थान *",
                    weekFromText: "सप्ताह से *",
                    weekToText: "सप्ताह तक *",
                    preparedText: "द्वारा तैयार *",
                    submissionText: "जमा करने की तारीख *",
                    manpowerText: "कार्यबल सारांश (न्यूनतम / अधिकतम / औसत)",
                    addRowText: "पंक्ति जोड़ें",
                    categoryText: "श्रेणी",
                    minimumText: "न्यूनतम",
                    maximumText: "अधिकतम",
                    averageText: "औसत",
                    actionsText: "कार्रवाई",
                    activitiesText: "मुख्य कार्य गतिविधियाँ (साप्ताहिक)",
                    activityText: "गतिविधि विवरण",
                    statusText: "स्थिति / टिप्पणियाँ",
                    permitsText: "जारी किए गए परमिट (साप्ताहिक सारांश)",
                    typeText: "परमिट का प्रकार",
                    totalText: "कुल जारी",
                    renewedText: "नवीनीकृत",
                    observationsText: "सुरक्षा अवलोकन / निष्कर्ष",
                    unsafeText: "असुरक्षित कार्य/स्थिति",
                    correctiveText: "सुधारात्मक कार्रवाई",
                    incidentsText: "घटनाएं / नियर मिस",
                    dateText: "तारीख",
                    descriptionText: "विवरण",
                    rootText: "मूल कारण",
                    actionText: "की गई कार्रवाई",
                    trainingText: "सुरक्षा प्रशिक्षण और टूलबॉक्स टॉक",
                    topicText: "विषय",
                    conductedText: "द्वारा आयोजित",
                    participantsText: "प्रतिभागी",
                    remarksText: "टिप्पणियाँ",
                    additionalText: "अतिरिक्त जानकारी",
                    housekeepingText: "हाउसकीपिंग और कल्याण",
                    highlightsText: "मुख्य आकर्षण और सुधार (इस सप्ताह)",
                    challengesText: "चुनौतियाँ और लंबित मुद्दे",
                    summaryText: "सारांश रेटिंग",
                    excellentText: "उत्कृष्ट",
                    satisfactoryText: "संतोषजनक",
                    improvementText: "सुधार की आवश्यकता",
                    previewInstructionText: "जनरेट करने के लिए पूर्वावलोकन पर क्लिक करें।",
                    clearText: "सभी साफ करें",
                    autosaveText: "स्वचालित रूप से सहेजा गया"
                }
            };

            translateBtn.addEventListener('click', function() {
                isHindi = !isHindi;
                const lang = isHindi ? 'hi' : 'en';
                
                // Update all text elements
                document.querySelectorAll('.theme-text').forEach(el => {
                    el.textContent = translations[lang].themeText;
                });
                document.querySelector('.title-text').textContent = translations[lang].titleText;
                document.querySelector('.subtitle-text').textContent = translations[lang].subtitleText;
                document.querySelector('.translate-text').textContent = translations[lang].translateText;
                document.querySelector('.preview-text').textContent = translations[lang].previewText;
                document.querySelector('.download-text').textContent = translations[lang].downloadText;
                document.querySelector('.save-text').textContent = translations[lang].saveText;
                document.querySelector('.reset-text').textContent = translations[lang].resetText;
                document.querySelector('.details-text').textContent = translations[lang].detailsText;
                document.querySelector('.site-text').textContent = translations[lang].siteText;
                document.querySelector('.location-text').textContent = translations[lang].locationText;
                document.querySelector('.week-from-text').textContent = translations[lang].weekFromText;
                document.querySelector('.week-to-text').textContent = translations[lang].weekToText;
                document.querySelector('.prepared-text').textContent = translations[lang].preparedText;
                document.querySelector('.submission-text').textContent = translations[lang].submissionText;
                document.querySelector('.manpower-text').textContent = translations[lang].manpowerText;
                document.querySelectorAll('.add-row-text').forEach(el => {
                    el.textContent = translations[lang].addRowText;
                });
                document.querySelector('.category-text').textContent = translations[lang].categoryText;
                document.querySelector('.minimum-text').textContent = translations[lang].minimumText;
                document.querySelector('.maximum-text').textContent = translations[lang].maximumText;
                document.querySelector('.average-text').textContent = translations[lang].averageText;
                document.querySelectorAll('.actions-text').forEach(el => {
                    el.textContent = translations[lang].actionsText;
                });
                document.querySelector('.activities-text').textContent = translations[lang].activitiesText;
                document.querySelector('.activity-text').textContent = translations[lang].activityText;
                document.querySelectorAll('.status-text').forEach(el => {
                    el.textContent = translations[lang].statusText;
                });
                document.querySelector('.permits-text').textContent = translations[lang].permitsText;
                document.querySelectorAll('.type-text').forEach(el => {
                    el.textContent = translations[lang].typeText;
                });
                document.querySelector('.total-text').textContent = translations[lang].totalText;
                document.querySelector('.renewed-text').textContent = translations[lang].renewedText;
                document.querySelector('.observations-text').textContent = translations[lang].observationsText;
                document.querySelector('.unsafe-text').textContent = translations[lang].unsafeText;
                document.querySelector('.corrective-text').textContent = translations[lang].correctiveText;
                document.querySelector('.incidents-text').textContent = translations[lang].incidentsText;
                document.querySelectorAll('.date-text').forEach(el => {
                    el.textContent = translations[lang].dateText;
                });
                document.querySelector('.description-text').textContent = translations[lang].descriptionText;
                document.querySelector('.root-text').textContent = translations[lang].rootText;
                document.querySelector('.action-text').textContent = translations[lang].actionText;
                document.querySelector('.training-text').textContent = translations[lang].trainingText;
                document.querySelector('.topic-text').textContent = translations[lang].topicText;
                document.querySelector('.conducted-text').textContent = translations[lang].conductedText;
                document.querySelector('.participants-text').textContent = translations[lang].participantsText;
                document.querySelector('.remarks-text').textContent = translations[lang].remarksText;
                document.querySelector('.additional-text').textContent = translations[lang].additionalText;
                document.querySelector('.housekeeping-text').textContent = translations[lang].housekeepingText;
                document.querySelector('.highlights-text').textContent = translations[lang].highlightsText;
                document.querySelector('.challenges-text').textContent = translations[lang].challengesText;
                document.querySelector('.summary-text').textContent = translations[lang].summaryText;
                document.querySelector('.excellent-text').textContent = translations[lang].excellentText;
                document.querySelector('.satisfactory-text').textContent = translations[lang].satisfactoryText;
                document.querySelector('.improvement-text').textContent = translations[lang].improvementText;
                document.querySelector('.preview-instruction-text').textContent = translations[lang].previewInstructionText;
                document.querySelector('.clear-text').textContent = translations[lang].clearText;
                document.querySelector('.autosave-text').textContent = translations[lang].autosaveText;
            });

            // Theme Toggle
            const themeToggle = document.getElementById('themeToggle');
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    document.querySelector('.theme-text').textContent = isHindi ? 'लाइट मोड' : 'Light Mode';
                } else {
                    document.querySelector('.theme-text').textContent = isHindi ? 'डार्क मोड' : 'Dark Mode';
                }
            });

            // Add row functionality for all tables
            const addRowButtons = {
                addManpowerRow: 'manpowerTableBody',
                addActivityRow: 'activitiesTableBody',
                addPermitRow: 'permitsTableBody',
                addObservationRow: 'observationsTableBody',
                addIncidentRow: 'incidentsTableBody',
                addTrainingRow: 'trainingTableBody'
            };

            for (const [buttonId, tableBodyId] of Object.entries(addRowButtons)) {
                document.getElementById(buttonId).addEventListener('click', function() {
                    addTableRow(tableBodyId);
                });
            }

            function addTableRow(tableBodyId) {
                const tableBody = document.getElementById(tableBodyId);
                const newRow = document.createElement('tr');
                
                switch(tableBodyId) {
                    case 'manpowerTableBody':
                        newRow.innerHTML = `
                            <td><input type="text" placeholder="Category"></td>
                            <td><input type="number" placeholder="Min" min="0"></td>
                            <td><input type="number" placeholder="Max" min="0"></td>
                            <td><input type="number" placeholder="Avg" min="0" step="0.1"></td>
                            <td><button class="delete-btn" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                        `;
                        break;
                    case 'activitiesTableBody':
                        newRow.innerHTML = `
                            <td><input type="text" placeholder="Activity description"></td>
                            <td><input type="text" placeholder="Location"></td>
                            <td><input type="text" placeholder="Status/Remarks"></td>
                            <td><button class="delete-btn" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                        `;
                        break;
                    case 'permitsTableBody':
                        newRow.innerHTML = `
                            <td>
                                <select>
                                    <option value="hot-work">Hot Work</option>
                                    <option value="height">Work at Height</option>
                                    <option value="confined">Confined Space</option>
                                    <option value="electrical">Electrical Work</option>
                                    <option value="lifting">Lifting</option>
                                    <option value="excavation">Excavation</option>
                                </select>
                            </td>
                            <td><input type="number" placeholder="Total" min="0"></td>
                            <td><input type="number" placeholder="Renewed" min="0"></td>
                            <td><button class="delete-btn" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                        `;
                        break;
                    case 'observationsTableBody':
                        newRow.innerHTML = `
                            <td><input type="text" placeholder="Unsafe act/condition"></td>
                            <td><input type="text" placeholder="Corrective action"></td>
                            <td>
                                <select>
                                    <option value="open">Open</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="closed">Closed</option>
                                </select>
                            </td>
                            <td><button class="delete-btn" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                        `;
                        break;
                    case 'incidentsTableBody':
                        newRow.innerHTML = `
                            <td><input type="date"></td>
                            <td>
                                <select>
                                    <option value="incident">Incident</option>
                                    <option value="near-miss">Near Miss</option>
                                    <option value="hazard">Hazard</option>
                                </select>
                            </td>
                            <td><input type="text" placeholder="Description"></td>
                            <td><input type="text" placeholder="Root cause"></td>
                            <td><input type="text" placeholder="Action taken"></td>
                            <td><button class="delete-btn" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                        `;
                        break;
                    case 'trainingTableBody':
                        newRow.innerHTML = `
                            <td><input type="date"></td>
                            <td><input type="text" placeholder="Topic"></td>
                            <td><input type="text" placeholder="Conducted by"></td>
                            <td><input type="number" placeholder="Participants" min="0"></td>
                            <td><input type="text" placeholder="Remarks"></td>
                            <td><button class="delete-btn" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                        `;
                        break;
                }
                
                tableBody.appendChild(newRow);
            }

            // Delete row function
            window.deleteRow = function(button) {
                const row = button.closest('tr');
                row.remove();
            };

            // Preview functionality
            document.getElementById('previewBtn').addEventListener('click', function() {
                generatePreview();
            });

            function generatePreview() {
                const previewContent = document.getElementById('previewContent');
                let previewHTML = `
                    <h2>Weekly Safety Report</h2>
                    
                    <div class="preview-section-title">Report Details</div>
                    <table class="preview-table">
                        <tr>
                            <td><strong>Project/Site:</strong></td>
                            <td>${document.getElementById('siteName').value || 'Not specified'}</td>
                        </tr>
                        <tr>
                            <td><strong>Location:</strong></td>
                            <td>${document.getElementById('location').value || 'Not specified'}</td>
                        </tr>
                        <tr>
                            <td><strong>Week:</strong></td>
                            <td>${document.getElementById('weekFrom').value || 'Not specified'} to ${document.getElementById('weekTo').value || 'Not specified'}</td>
                        </tr>
                        <tr>
                            <td><strong>Prepared by:</strong></td>
                            <td>${document.getElementById('preparedBy').value || 'Not specified'}</td>
                        </tr>
                        <tr>
                            <td><strong>Date of submission:</strong></td>
                            <td>${document.getElementById('submissionDate').value || 'Not specified'}</td>
                        </tr>
                    </table>
                    
                    <div class="preview-section-title">Manpower Summary</div>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Minimum</th>
                                <th>Maximum</th>
                                <th>Average</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Add manpower rows
                const manpowerRows = document.querySelectorAll('#manpowerTableBody tr');
                if (manpowerRows.length > 0) {
                    manpowerRows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        previewHTML += `
                            <tr>
                                <td>${cells[0].querySelector('input').value || ''}</td>
                                <td>${cells[1].querySelector('input').value || ''}</td>
                                <td>${cells[2].querySelector('input').value || ''}</td>
                                <td>${cells[3].querySelector('input').value || ''}</td>
                            </tr>
                        `;
                    });
                } else {
                    previewHTML += '<tr><td colspan="4">No data entered</td></tr>';
                }
                
                previewHTML += `
                        </tbody>
                    </table>
                    
                    <div class="preview-section-title">Key Work Activities</div>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Activity Description</th>
                                <th>Location</th>
                                <th>Status / Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Add activity rows
                const activityRows = document.querySelectorAll('#activitiesTableBody tr');
                if (activityRows.length > 0) {
                    activityRows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        previewHTML += `
                            <tr>
                                <td>${cells[0].querySelector('input').value || ''}</td>
                                <td>${cells[1].querySelector('input').value || ''}</td>
                                <td>${cells[2].querySelector('input').value || ''}</td>
                            </tr>
                        `;
                    });
                } else {
                    previewHTML += '<tr><td colspan="3">No data entered</td></tr>';
                }
                
                previewHTML += `
                        </tbody>
                    </table>
                    
                    <div class="preview-section-title">Permits Issued</div>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Type of Permit</th>
                                <th>Total Issued</th>
                                <th>Renewed</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Add permit rows
                const permitRows = document.querySelectorAll('#permitsTableBody tr');
                if (permitRows.length > 0) {
                    permitRows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        const permitType = cells[0].querySelector('select').value;
                        const permitTypeText = {
                            'hot-work': 'Hot Work',
                            'height': 'Work at Height',
                            'confined': 'Confined Space',
                            'electrical': 'Electrical Work',
                            'lifting': 'Lifting',
                            'excavation': 'Excavation'
                        }[permitType] || permitType;
                        
                        previewHTML += `
                            <tr>
                                <td>${permitTypeText}</td>
                                <td>${cells[1].querySelector('input').value || ''}</td>
                                <td>${cells[2].querySelector('input').value || ''}</td>
                            </tr>
                        `;
                    });
                } else {
                    previewHTML += '<tr><td colspan="3">No data entered</td></tr>';
                }
                
                previewHTML += `
                        </tbody>
                    </table>
                    
                    <div class="preview-section-title">Safety Observations / Findings</div>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Unsafe Act/Condition</th>
                                <th>Corrective Action</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Add observation rows
                const observationRows = document.querySelectorAll('#observationsTableBody tr');
                if (observationRows.length > 0) {
                    observationRows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        previewHTML += `
                            <tr>
                                <td>${cells[0].querySelector('input').value || ''}</td>
                                <td>${cells[1].querySelector('input').value || ''}</td>
                                <td>${cells[2].querySelector('select').value || ''}</td>
                            </tr>
                        `;
                    });
                } else {
                    previewHTML += '<tr><td colspan="3">No data entered</td></tr>';
                }
                
                previewHTML += `
                        </tbody>
                    </table>
                    
                    <div class="preview-section-title">Incidents / Near Misses</div>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Root Cause</th>
                                <th>Action Taken</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Add incident rows
                const incidentRows = document.querySelectorAll('#incidentsTableBody tr');
                if (incidentRows.length > 0) {
                    incidentRows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        previewHTML += `
                            <tr>
                                <td>${cells[0].querySelector('input').value || ''}</td>
                                <td>${cells[1].querySelector('select').value || ''}</td>
                                <td>${cells[2].querySelector('input').value || ''}</td>
                                <td>${cells[3].querySelector('input').value || ''}</td>
                                <td>${cells[4].querySelector('input').value || ''}</td>
                            </tr>
                        `;
                    });
                } else {
                    previewHTML += '<tr><td colspan="5">No data entered</td></tr>';
                }
                
                previewHTML += `
                        </tbody>
                    </table>
                    
                    <div class="preview-section-title">Safety Training & Toolbox Talks</div>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Topic</th>
                                <th>Conducted By</th>
                                <th>Participants</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Add training rows
                const trainingRows = document.querySelectorAll('#trainingTableBody tr');
                if (trainingRows.length > 0) {
                    trainingRows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        previewHTML += `
                            <tr>
                                <td>${cells[0].querySelector('input').value || ''}</td>
                                <td>${cells[1].querySelector('input').value || ''}</td>
                                <td>${cells[2].querySelector('input').value || ''}</td>
                                <td>${cells[3].querySelector('input').value || ''}</td>
                                <td>${cells[4].querySelector('input').value || ''}</td>
                            </tr>
                        `;
                    });
                } else {
                    previewHTML += '<tr><td colspan="5">No data entered</td></tr>';
                }
                
                previewHTML += `
                        </tbody>
                    </table>
                    
                    <div class="preview-section-title">Additional Information</div>
                    <table class="preview-table">
                        <tr>
                            <td><strong>Housekeeping & Welfare:</strong></td>
                            <td>${document.getElementById('housekeeping').value || 'Not specified'}</td>
                        </tr>
                        <tr>
                            <td><strong>Highlights & Improvements:</strong></td>
                            <td>${document.getElementById('highlights').value || 'Not specified'}</td>
                        </tr>
                        <tr>
                            <td><strong>Challenges & Pending Issues:</strong></td>
                            <td>${document.getElementById('challenges').value || 'Not specified'}</td>
                        </tr>
                        <tr>
                            <td><strong>Summary Rating:</strong></td>
                            <td>${document.querySelector('input[name="rating"]:checked').nextElementSibling.textContent}</td>
                        </tr>
                    </table>
                `;
                
                previewContent.innerHTML = previewHTML;
            }

            // Save draft functionality
            document.getElementById('saveBtn').addEventListener('click', function() {
                saveDraft();
                alert(isHindi ? 'ड्राफ्ट सफलतापूर्वक सहेजा गया!' : 'Draft saved successfully!');
            });

            function saveDraft() {
                const formData = {
                    siteName: document.getElementById('siteName').value,
                    location: document.getElementById('location').value,
                    weekFrom: document.getElementById('weekFrom').value,
                    weekTo: document.getElementById('weekTo').value,
                    preparedBy: document.getElementById('preparedBy').value,
                    submissionDate: document.getElementById('submissionDate').value,
                    housekeeping: document.getElementById('housekeeping').value,
                    highlights: document.getElementById('highlights').value,
                    challenges: document.getElementById('challenges').value,
                    rating: document.querySelector('input[name="rating"]:checked').value
                };
                
                localStorage.setItem('weeklySafetyReportDraft', JSON.stringify(formData));
            }

            // Reset functionality
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (confirm(isHindi ? 'क्या आप वाकई फॉर्म रीसेट करना चाहते हैं? सभी डेटा खो जाएगा।' : 'Are you sure you want to reset the form? All data will be lost.')) {
                    resetForm();
                }
            });

            document.getElementById('finalResetBtn').addEventListener('click', function() {
                if (confirm(isHindi ? 'क्या आप वाकई फॉर्म रीसेट करना चाहते हैं? सभी डेटा खो जाएगा।' : 'Are you sure you want to reset the form? All data will be lost.')) {
                    resetForm();
                }
            });

            function resetForm() {
                document.querySelectorAll('input, textarea').forEach(element => {
                    if (element.type !== 'button' && element.type !== 'submit' && element.type !== 'radio') {
                        element.value = '';
                    }
                });
                
                document.querySelectorAll('table tbody').forEach(tbody => {
                    tbody.innerHTML = '';
                });
                
                document.getElementById('satisfactory').checked = true;
                
                // Reset dates to default
                const today = new Date();
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());
                
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                document.getElementById('weekFrom').value = weekStart.toISOString().split('T')[0];
                document.getElementById('weekTo').value = weekEnd.toISOString().split('T')[0];
                document.getElementById('submissionDate').value = today.toISOString().split('T')[0];
                
                document.getElementById('previewContent').innerHTML = '<p class="preview-instruction-text">Click Preview to generate.</p>';
                
                alert(isHindi ? 'फॉर्म सफलतापूर्वक रीसेट कर दिया गया है!' : 'Form has been reset successfully!');
            }

            // PDF download functionality
            document.getElementById('downloadBtn').addEventListener('click', function() {
                downloadPDF();
            });

            document.getElementById('finalDownloadBtn').addEventListener('click', function() {
                downloadPDF();
            });

            function downloadPDF() {
                const previewContent = document.getElementById('previewContent');
                
                if (previewContent.innerHTML.includes('Click Preview to generate')) {
                    alert(isHindi ? 'कृपया पहले रिपोर्ट का पूर्वावलोकन करें!' : 'Please preview the report first!');
                    return;
                }
                
                html2canvas(previewContent).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                    const imgWidth = 210;
                    const pageHeight = 295;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    pdf.save('weekly-safety-report.pdf');
                });
            }

            // Auto-save every 30 seconds
            setInterval(saveDraft, 30000);

            // Load draft on page load if available
            window.addEventListener('load', function() {
                const draft = localStorage.getItem('weeklySafetyReportDraft');
                if (draft) {
                    const formData = JSON.parse(draft);
                    document.getElementById('siteName').value = formData.siteName || '';
                    document.getElementById('location').value = formData.location || '';
                    document.getElementById('weekFrom').value = formData.weekFrom || '';
                    document.getElementById('weekTo').value = formData.weekTo || '';
                    document.getElementById('preparedBy').value = formData.preparedBy || '';
                    document.getElementById('submissionDate').value = formData.submissionDate || '';
                    document.getElementById('housekeeping').value = formData.housekeeping || '';
                    document.getElementById('highlights').value = formData.highlights || '';
                    document.getElementById('challenges').value = formData.challenges || '';
                    
                    if (formData.rating) {
                        document.getElementById(formData.rating).checked = true;
                    }
                }
            });
        });
    </script>
</body>
</html>