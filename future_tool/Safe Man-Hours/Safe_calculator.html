<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSE Tools - Safe Man-Hours Calculator & Permit-to-Work System</title>
    <meta name="description" content="Professional HSE tools for calculating safe man-hours and managing permit-to-work systems. Improve workplace safety with our comprehensive solutions.">
    <meta name="keywords" content="HSE, safety, man-hours, permit to work, PTW, workplace safety, risk management">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        :root {
            --primary: #2c5aa0;
            --primary-dark: #1e3d72;
            --secondary: #4caf50;
            --secondary-dark: #388e3c;
            --danger: #f44336;
            --warning: #ff9800;
            --info: #2196f3;
            --light: #f5f7fa;
            --dark: #333;
            --gray: #6c757d;
            --border: #dee2e6;
            --bg-color: #f5f7fa;
            --card-bg: white;
            --text-color: #333;
        }
        
        .dark-mode {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #f0f0f0;
            --border: #444;
            --light: #2d2d2d;
            --gray: #aaa;
        }
        
        body {
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header - Auto Adjust */
        header {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 250px;
        }
        
        .logo-icon {
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .logo-text h1 {
            font-size: clamp(20px, 4vw, 28px);
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .logo-text p {
            color: var(--gray);
            font-size: clamp(12px, 2vw, 14px);
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        /* Buttons - Auto Adjust */
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-success {
            background: var(--secondary);
            color: white;
        }
        
        .btn-success:hover {
            background: var(--secondary-dark);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-back {
            background: var(--gray);
            color: white;
        }
        
        /* Card Container - Auto Adjust Grid */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 350px), 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            height: fit-content;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .card-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .card-title {
            font-size: clamp(16px, 3vw, 20px);
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Form Elements - Auto Adjust */
        .form-group {
            margin-bottom: 18px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s;
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }
        
        /* Form Grid - Auto Adjust */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 200px), 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        /* LTI Options - Auto Adjust */
        .lti-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .lti-option {
            text-align: center;
        }
        
        .lti-option input {
            display: none;
        }
        
        .lti-option label {
            display: block;
            padding: 12px 8px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 13px;
        }
        
        .lti-option input:checked + label {
            border-color: var(--primary);
            background: rgba(44, 90, 160, 0.1);
            color: var(--primary);
        }
        
        .lti-option label:hover {
            border-color: var(--primary);
        }
        
        /* Workforce Card - Full Width */
        .workforce-card {
            grid-column: 1 / -1;
        }
        
        .workforce-container {
            overflow-x: auto;
        }
        
        .workforce-table {
            width: 100%;
            min-width: 700px;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .workforce-table th {
            background: var(--primary);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        
        .workforce-table td {
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .workforce-table input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .remove-btn {
            color: var(--danger);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: color 0.3s;
            padding: 5px;
        }
        
        .remove-btn:hover {
            color: #b71c1c;
        }
        
        .tip {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 12px 15px;
            border-radius: 6px;
            font-size: 13px;
            color: var(--gray);
            margin-top: 15px;
            border-left: 4px solid var(--info);
        }
        
        /* Template Section - Auto Adjust */
        .template-section {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: end;
            margin-bottom: 15px;
        }
        
        .milestones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 200px), 1fr));
            gap: 15px;
        }
        
        .footer-note {
            margin-top: 25px;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--gray);
            text-align: center;
            background: var(--card-bg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        /* Popup Preview - Auto Adjust */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .popup-content {
            background: var(--card-bg);
            width: 100%;
            max-width: min(95%, 900px);
            max-height: 90vh;
            border-radius: 8px;
            overflow-y: auto;
            padding: 25px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .popup-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s;
        }
        
        .popup-close:hover {
            color: var(--text-color);
        }
        
        .popup-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* A4 Preview - Auto Adjust */
        .a4-preview {
            width: 100%;
            max-width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border: 1px solid #ccc;
        }
        
        .a4-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
        }
        
        .a4-header h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: clamp(20px, 4vw, 24px);
        }
        
        .a4-date {
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
        }
        
        .a4-section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #fafbfc;
        }
        
        .a4-section h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            font-size: clamp(16px, 3vw, 18px);
        }
        
        .a4-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .a4-box {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .a4-box h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .a4-box .value {
            font-size: clamp(20px, 4vw, 24px);
            font-weight: bold;
            color: var(--secondary);
        }
        
        /* Preview Tables - Auto Adjust */
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: clamp(10px, 2vw, 12px);
            border: 1px solid var(--dark);
        }
        
        .preview-table th {
            background: var(--primary);
            color: white;
            padding: 10px 8px;
            text-align: center;
            border: 1px solid var(--dark);
            font-weight: 600;
        }
        
        .preview-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid var(--dark);
        }
        
        .preview-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .project-info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border: 1px solid var(--dark);
            font-size: clamp(11px, 2vw, 13px);
        }
        
        .project-info-table th, .project-info-table td {
            padding: 10px;
            border: 1px solid var(--dark);
            text-align: left;
        }
        
        .project-info-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            width: 30%;
        }
        
        .project-info-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .preview-list {
            list-style-type: none;
            margin: 15px 0;
        }
        
        .preview-list li {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .preview-list li:before {
            content: "•";
            color: var(--secondary);
            font-size: 20px;
        }
        
        /* PTW Styles */
        .permit-templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .permit-template {
            text-align: center;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--card-bg);
        }
        
        .permit-template:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }
        
        .permit-template.active {
            border-color: var(--primary);
            background: rgba(44, 90, 160, 0.1);
        }
        
        .permit-template i {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input {
            width: auto;
        }
        
        .hazards-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .hazards-table th {
            background: var(--primary);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        
        .hazards-table td {
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .hazards-table input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .signature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        /* Mobile-First Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header {
                padding: 15px;
                text-align: center;
                flex-direction: column;
            }
            
            .logo {
                justify-content: center;
                text-align: center;
            }
            
            .header-actions {
                justify-content: center;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .card {
                padding: 15px;
            }
            
            .card-header {
                flex-direction: column;
                text-align: center;
            }
            
            .card-icon {
                margin: 0 auto;
            }
            
            .template-section {
                grid-template-columns: 1fr;
            }
            
            .workforce-table {
                min-width: 600px;
            }
            
            .a4-preview {
                padding: 10mm;
            }
            
            .popup-content {
                padding: 20px;
            }
            
            .permit-templates {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .popup-actions {
                flex-direction: column;
            }
            
            .a4-preview {
                padding: 8mm;
            }
            
            .preview-table, .project-info-table {
                font-size: 10px;
            }
            
            .preview-table th, .preview-table td,
            .project-info-table th, .project-info-table td {
                padding: 6px 4px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .milestones-grid {
                grid-template-columns: 1fr;
            }
            
            .permit-templates {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 1200px) {
            .card-container {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .workforce-card {
                grid-column: span 3;
            }
        }
        
        @media (min-width: 1600px) {
            .card-container {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .workforce-card {
                grid-column: span 4;
            }
        }
        
        /* Toggle Buttons */
        .toggle-buttons {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }
        
        .toggle-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .toggle-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            text-align: center;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            background: rgba(44, 90, 160, 0.05);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Loading indicator for PDF generation */
        .loading-indicator {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-size: 18px;
        }
        
        .loading-indicator i {
            font-size: 48px;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading-indicator" id="loadingIndicator">
        <i class="fas fa-spinner"></i>
        <p>Generating PDF, please wait...</p>
    </div>
    
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-hard-hat"></i>
                </div>
                <div class="logo-text">
                    <h1 data-en="HSE Safety Tools" data-hi="एचएसई सुरक्षा उपकरण">HSE Safety Tools</h1>
                    <p data-en="Safe Man-Hours Calculator & Permit-to-Work System" data-hi="सुरक्षित मैन-आवर कैलकुलेटर और परमिट-टू-वर्क सिस्टम">Safe Man-Hours Calculator & Permit-to-Work System</p>
                </div>
            </div>
            <div class="toggle-buttons">
                <button class="toggle-btn" id="languageToggle">
                    <i class="fas fa-language"></i> <span data-en="EN/HI" data-hi="अंग्रेजी/हिंदी">EN/HI</span>
                </button>
                <button class="toggle-btn" id="themeToggle">
                    <i class="fas fa-moon"></i> <span data-en="Dark/Light" data-hi="डार्क/लाइट">Dark/Light</span>
                </button>
            </div>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="man-hours" data-en="Safe Man-Hours Calculator" data-hi="सुरक्षित मैन-आवर कैलकुलेटर">Safe Man-Hours Calculator</div>
            <div class="tab" data-tab="permit" data-en="Permit-to-Work (PTW)" data-hi="कार्य अनुमति (पीटीडब्ल्यू)">Permit-to-Work (PTW)</div>
        </div>
        
        <!-- Safe Man-Hours Calculator Tab -->
        <div class="tab-content active" id="man-hours-content">
            <div class="card-container">
                <!-- Project Details Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #e3f2fd; color: #1976d2;">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <h2 class="card-title" data-en="Project / Site Details" data-hi="परियोजना / साइट विवरण">Project / Site Details</h2>
                    </div>
                    <div class="form-group">
                        <label for="projectName" data-en="Project / Site Name" data-hi="परियोजना / साइट का नाम">Project / Site Name</label>
                        <input type="text" id="projectName" placeholder="e.g., Greenfield Refinery Expansion" data-en-placeholder="e.g., Greenfield Refinery Expansion" data-hi-placeholder="उदा., ग्रीनफील्ड रिफाइनरी विस्तार">
                    </div>
                    <div class="form-group">
                        <label for="location" data-en="Location" data-hi="स्थान">Location</label>
                        <input type="text" id="location" placeholder="City, Country" data-en-placeholder="City, Country" data-hi-placeholder="शहर, देश">
                    </div>
                    <div class="form-group">
                        <label for="client" data-en="Client / Company" data-hi="क्लाइंट / कंपनी">Client / Company</label>
                        <input type="text" id="client" placeholder="e.g., ABC Energy Pvt. Ltd." data-en-placeholder="e.g., ABC Energy Pvt. Ltd." data-hi-placeholder="उदा., एबीसी एनर्जी प्रा. लिमिटेड">
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="periodFrom" data-en="Reporting Period (From)" data-hi="रिपोर्टिंग अवधि (से)">Reporting Period (From)</label>
                            <input type="date" id="periodFrom">
                        </div>
                        <div class="form-group">
                            <label for="periodTo" data-en="Reporting Period (To)" data-hi="रिपोर्टिंग अवधि (तक)">Reporting Period (To)</label>
                            <input type="date" id="periodTo">
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-en="LTI Occurred?" data-hi="एलटीआई हुआ?">LTI Occurred?</label>
                        <div class="lti-options">
                            <div class="lti-option">
                                <input type="radio" id="lti-no" name="lti" value="no" checked>
                                <label for="lti-no" data-en="No (Counter continues)" data-hi="नहीं (काउंटर जारी)">No (Counter continues)</label>
                            </div>
                            <div class="lti-option">
                                <input type="radio" id="lti-yes" name="lti" value="yes">
                                <label for="lti-yes" data-en="Yes (Reset counter)" data-hi="हाँ (काउंटर रीसेट)">Yes (Reset counter)</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Workforce & Hours Card -->
                <div class="card workforce-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #e8f5e9; color: #388e3c;">
                            <i class="fas fa-users"></i>
                        </div>
                        <h2 class="card-title" data-en="Workforce & Hours" data-hi="कार्यबल और घंटे">Workforce & Hours</h2>
                    </div>
                    
                    <div class="workforce-container">
                        <table class="workforce-table">
                            <thead>
                                <tr>
                                    <th data-en="Category / Crew" data-hi="श्रेणी / कर्मी दल">Category / Crew</th>
                                    <th data-en="# Workers" data-hi="# कर्मचारी"># Workers</th>
                                    <th data-en="Hours/Day" data-hi="घंटे/दिन">Hours/Day</th>
                                    <th data-en="Days (No LTI)" data-hi="दिन (कोई एलटीआई नहीं)">Days (No LTI)</th>
                                    <th data-en="OT Hours/Day" data-hi="ओवरटाइम घंटे/दिन">OT Hours/Day</th>
                                    <th data-en="Shifts/Day" data-hi="शिफ्ट/दिन">Shifts/Day</th>
                                    <th data-en="Action" data-hi="कार्रवाई">Action</th>
                                </tr>
                            </thead>
                            <tbody id="workforceTableBody">
                                <tr>
                                    <td><input type="text" class="crew-input" value="General Workforce" placeholder="Category/Crew" data-en-placeholder="Category/Crew" data-hi-placeholder="श्रेणी/कर्मी दल"></td>
                                    <td><input type="number" class="workers-input" value="100" placeholder="Workers" data-en-placeholder="Workers" data-hi-placeholder="कर्मचारी"></td>
                                    <td><input type="number" class="hours-input" value="8" placeholder="Hours" data-en-placeholder="Hours" data-hi-placeholder="घंटे"></td>
                                    <td><input type="number" class="days-input" value="26" placeholder="Days" data-en-placeholder="Days" data-hi-placeholder="दिन"></td>
                                    <td><input type="number" class="ot-input" value="0" placeholder="OT Hours" data-en-placeholder="OT Hours" data-hi-placeholder="ओवरटाइम घंटे"></td>
                                    <td><input type="number" class="shifts-input" value="1" placeholder="Shifts" data-en-placeholder="Shifts" data-hi-placeholder="शिफ्ट"></td>
                                    <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <button class="btn btn-success" id="addRowBtn">
                        <i class="fas fa-plus"></i> <span data-en="Add Row" data-hi="पंक्ति जोड़ें">Add Row</span>
                    </button>
                    <div class="tip" data-en="Tip: Use separate rows for staff vs. contractors or different shift patterns." data-hi="सुझाव: स्टाफ बनाम ठेकेदार या विभिन्न शिफ्ट पैटर्न के लिए अलग-अलग पंक्तियों का उपयोग करें।">
                        Tip: Use separate rows for staff vs. contractors or different shift patterns.
                    </div>
                </div>
                
                <!-- Templates Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #fff3e0; color: #f57c00;">
                            <i class="fas fa-clone"></i>
                        </div>
                        <h2 class="card-title" data-en="Templates" data-hi="टेम्पलेट्स">Templates</h2>
                    </div>
                    <div class="template-section">
                        <div class="form-group">
                            <label for="templateSelect" data-en="Select a Template" data-hi="एक टेम्पलेट चुनें">Select a Template</label>
                            <select id="templateSelect">
                                <option data-en="– Choose –" data-hi="– चुनें –">– Choose –</option>
                                <option data-en="Construction Template" data-hi="निर्माण टेम्पलेट">Construction Template</option>
                                <option data-en="Manufacturing Template" data-hi="विनिर्माण टेम्पलेट">Manufacturing Template</option>
                                <option data-en="Oil & Gas Template" data-hi="तेल और गैस टेम्पलेट">Oil & Gas Template</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="applyTemplateBtn">
                            <i class="fas fa-check"></i> <span data-en="Apply Template" data-hi="टेम्पलेट लागू करें">Apply Template</span>
                        </button>
                    </div>
                    <div class="tip" data-en="Applying a template will auto-fill all sections (project info + workforce rows)." data-hi="टेम्पलेट लागू करने से सभी अनुभाग स्वचालित रूप से भर जाएंगे (परियोजना जानकारी + कार्यबल पंक्तियाँ)।">
                        Applying a template will auto-fill all sections (project info + workforce rows).
                    </div>
                </div>
                
                <!-- Milestones & Notes Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #f3e5f5; color: #7b1fa2;">
                            <i class="fas fa-flag-checkered"></i>
                        </div>
                        <h2 class="card-title" data-en="Milestones & Notes" data-hi="माइलस्टोन और नोट्स">Milestones & Notes</h2>
                    </div>
                    <div class="milestones-grid">
                        <div class="form-group">
                            <label for="previousHours" data-en="Previous Safe Man-Hours (carry-over)" data-hi="पिछले सुरक्षित मैन-आवर (कैरी-ओवर)">Previous Safe Man-Hours (carry-over)</label>
                            <input type="text" id="previousHours" placeholder="e.g., 980000" data-en-placeholder="e.g., 980000" data-hi-placeholder="उदा., 980000">
                        </div>
                        <div class="form-group">
                            <label for="cumulativeHours" data-en="Cumulative Safe Man-Hours" data-hi="संचयी सुरक्षित मैन-आवर">Cumulative Safe Man-Hours</label>
                            <input type="text" id="cumulativeHours" placeholder="Auto-calculated" readonly data-en-placeholder="Auto-calculated" data-hi-placeholder="स्वचालित गणना">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="highlights" data-en="Highlights / Remarks" data-hi="मुख्य बिंदु / टिप्पणियाँ">Highlights / Remarks</label>
                        <textarea id="highlights" rows="4" placeholder="Key highlights, toolbox talks, audits, observations..." data-en-placeholder="Key highlights, toolbox talks, audits, observations..." data-hi-placeholder="मुख्य बिंदु, टूलबॉक्स वार्ता, ऑडिट, अवलोकन..."></textarea>
                    </div>
                </div>
            </div>
            
            <!-- Actions Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #e1f5fe; color: #0288d1;">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h2 class="card-title" data-en="Actions" data-hi="कार्रवाइयाँ">Actions</h2>
                </div>
                <div class="form-grid">
                    <button class="btn btn-primary" id="previewBtn">
                        <i class="fas fa-eye"></i> <span data-en="Preview" data-hi="पूर्वावलोकन">Preview</span>
                    </button>
                    <button class="btn btn-success" id="downloadBtn">
                        <i class="fas fa-download"></i> <span data-en="Download PDF" data-hi="पीडीएफ डाउनलोड करें">Download PDF</span>
                    </button>
                    <button class="btn btn-danger" id="resetBtn">
                        <i class="fas fa-redo"></i> <span data-en="Reset" data-hi="रीसेट">Reset</span>
                    </button>
                </div>
            </div>
            
            <div class="footer-note" data-en="If LTI occurred = Yes, the counter since last LTI section resets to 0. Employee hours software Safety Training Courses" data-hi="यदि एलटीआई हुआ = हाँ, तो अंतिम एलटीआई अनुभाग से काउंटर 0 पर रीसेट हो जाता है। कर्मचारी घंटे सॉफ्टवेयर सुरक्षा प्रशिक्षण पाठ्यक्रम">
                If LTI occurred = Yes, the counter since last LTI section resets to 0. Employee hours software Safety Training Courses
            </div>
        </div>
        
        <!-- Permit-to-Work Tab -->
        <div class="tab-content" id="permit-content">
            <div class="card-container">
                <!-- Project Details Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #e3f2fd; color: #1976d2;">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <h2 class="card-title" data-en="Project / Site Details" data-hi="परियोजना / साइट विवरण">Project / Site Details</h2>
                    </div>
                    <div class="form-group">
                        <label for="ptwProjectName" data-en="Project / Site Name" data-hi="परियोजना / साइट का नाम">Project / Site Name</label>
                        <input type="text" id="ptwProjectName" placeholder="Enter project/site name" data-en-placeholder="Enter project/site name" data-hi-placeholder="परियोजना/साइट का नाम दर्ज करें">
                    </div>
                    <div class="form-group">
                        <label for="ptwLocation" data-en="Location / Area" data-hi="स्थान / क्षेत्र">Location / Area</label>
                        <input type="text" id="ptwLocation" placeholder="Enter location/area" data-en-placeholder="Enter location/area" data-hi-placeholder="स्थान/क्षेत्र दर्ज करें">
                    </div>
                    <div class="form-group">
                        <label for="ptwClient" data-en="Client / Company" data-hi="क्लाइंट / कंपनी">Client / Company</label>
                        <input type="text" id="ptwClient" placeholder="Enter client/company name" data-en-placeholder="Enter client/company name" data-hi-placeholder="क्लाइंट/कंपनी का नाम दर्ज करें">
                    </div>
                </div>
                
                <!-- Permit Templates Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #fff3e0; color: #f57c00;">
                            <i class="fas fa-clone"></i>
                        </div>
                        <h2 class="card-title" data-en="Load Template" data-hi="टेम्पलेट लोड करें">Load Template</h2>
                    </div>
                    <div class="permit-templates">
                        <div class="permit-template" data-template="hot-work">
                            <i class="fas fa-fire"></i>
                            <div data-en="Hot Work" data-hi="हॉट वर्क">Hot Work</div>
                        </div>
                        <div class="permit-template" data-template="confined-space">
                            <i class="fas fa-box"></i>
                            <div data-en="Confined Space" data-hi="सीमित स्थान">Confined Space</div>
                        </div>
                        <div class="permit-template" data-template="electrical">
                            <i class="fas fa-bolt"></i>
                            <div data-en="Electrical" data-hi="इलेक्ट्रिकल">Electrical</div>
                        </div>
                        <div class="permit-template" data-template="working-height">
                            <i class="fas fa-mountain"></i>
                            <div data-en="Working at Height" data-hi="ऊंचाई पर कार्य">Working at Height</div>
                        </div>
                    </div>
                    <div class="tip" data-en="Note: What you need to prepare" data-hi="नोट: आपको क्या तैयार करने की आवश्यकता है">
                        Note: What you need to prepare
                    </div>
                </div>
                
                <!-- Permit Details Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #e8f5e9; color: #388e3c;">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h2 class="card-title" data-en="Permit Details" data-hi="परमिट विवरण">Permit Details</h2>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="permitNo" data-en="Permit No" data-hi="परमिट नंबर">Permit No</label>
                            <input type="text" id="permitNo" value="PTW-251101-178" readonly>
                        </div>
                        <div class="form-group">
                            <label for="workType" data-en="Work Type" data-hi="कार्य प्रकार">Work Type</label>
                            <input type="text" id="workType" value="Hot Work" data-en-value="Hot Work" data-hi-value="हॉट वर्क">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="workDescription" data-en="Work Description / Scope" data-hi="कार्य विवरण / दायरा">Work Description / Scope</label>
                        <textarea id="workDescription" rows="3" placeholder="Describe the work to be performed" data-en-placeholder="Describe the work to be performed" data-hi-placeholder="किए जाने वाले कार्य का वर्णन करें"></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="requestedBy" data-en="Requested By" data-hi="द्वारा अनुरोध किया गया">Requested By</label>
                            <input type="text" id="requestedBy" placeholder="Enter name" data-en-placeholder="Enter name" data-hi-placeholder="नाम दर्ज करें">
                        </div>
                        <div class="form-group">
                            <label for="supervisor" data-en="Supervisor" data-hi="पर्यवेक्षक">Supervisor</label>
                            <input type="text" id="supervisor" placeholder="Enter name" data-en-placeholder="Enter name" data-hi-placeholder="नाम दर्ज करें">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="issuer" data-en="Issuer" data-hi="जारीकर्ता">Issuer</label>
                            <input type="text" id="issuer" placeholder="Enter name" data-en-placeholder="Enter name" data-hi-placeholder="नाम दर्ज करें">
                        </div>
                        <div class="form-group">
                            <label for="approver" data-en="Approver" data-hi="अनुमोदक">Approver</label>
                            <input type="text" id="approver" placeholder="Enter name" data-en-placeholder="Enter name" data-hi-placeholder="नाम दर्ज करें">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="validFrom" data-en="Valid From (Date & Time)" data-hi="मान्य से (तारीख और समय)">Valid From (Date & Time)</label>
                            <input type="datetime-local" id="validFrom">
                        </div>
                        <div class="form-group">
                            <label for="validTo" data-en="Valid To (Date & Time)" data-hi="मान्य तक (तारीख और समय)">Valid To (Date & Time)</label>
                            <input type="datetime-local" id="validTo">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="permitStatus" data-en="Permit Status" data-hi="परमिट स्थिति">Permit Status</label>
                        <select id="permitStatus">
                            <option value="open" data-en="Open" data-hi="खुला">Open</option>
                            <option value="closed" data-en="Closed" data-hi="बंद">Closed</option>
                            <option value="suspended" data-en="Suspended" data-hi="निलंबित">Suspended</option>
                            <option value="cancelled" data-en="Cancelled" data-hi="रद्द">Cancelled</option>
                        </select>
                    </div>
                </div>
                
                <!-- Checklists Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #f3e5f5; color: #7b1fa2;">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <h2 class="card-title" data-en="Checklists" data-hi="चेकलिस्ट">Checklists</h2>
                    </div>
                    
                    <div class="form-group">
                        <label data-en="PPE Required" data-hi="आवश्यक पीपीई">PPE Required</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-helmet">
                                <label for="ppe-helmet" data-en="Helmet" data-hi="हेलमेट">Helmet</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-shoes">
                                <label for="ppe-shoes" data-en="Safety Shoes" data-hi="सुरक्षा जूते">Safety Shoes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-vest">
                                <label for="ppe-vest" data-en="Hi-Vis Vest" data-hi="हाई-विज़ वेस्ट">Hi-Vis Vest</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-gloves">
                                <label for="ppe-gloves" data-en="Gloves" data-hi="दस्ताने">Gloves</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-goggles">
                                <label for="ppe-goggles" data-en="Safety Goggles" data-hi="सुरक्षा चश्मा">Safety Goggles</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-face-shield">
                                <label for="ppe-face-shield" data-en="Face Shield" data-hi="फेस शील्ड">Face Shield</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-hearing">
                                <label for="ppe-hearing" data-en="Hearing Protection" data-hi="श्रवण सुरक्षा">Hearing Protection</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-respirator">
                                <label for="ppe-respirator" data-en="Respirator (as required)" data-hi="श्वासयंत्र (आवश्यकतानुसार)">Respirator (as required)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ppe-fall-arrest">
                                <label for="ppe-fall-arrest" data-en="Fall Arrest (as required)" data-hi="फॉल अरेस्ट (आवश्यकतानुसार)">Fall Arrest (as required)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label data-en="Isolations / LOTO" data-hi="आइसोलेशन / लोटो">Isolations / LOTO</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="iso-electrical">
                                <label for="iso-electrical" data-en="Electrical isolation & LOTO applied" data-hi="इलेक्ट्रिकल आइसोलेशन और लोटो लागू">Electrical isolation & LOTO applied</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iso-mechanical">
                                <label for="iso-mechanical" data-en="Mechanical isolation (valves/spades)" data-hi="मैकेनिकल आइसोलेशन (वाल्व/स्पेड)">Mechanical isolation (valves/spades)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iso-depressurized">
                                <label for="iso-depressurized" data-en="Pneumatic/hydraulic depressurized" data-hi="न्यूमैटिक/हाइड्रोलिक डिप्रेसुराइज्ड">Pneumatic/hydraulic depressurized</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iso-drained">
                                <label for="iso-drained" data-en="Line drained & purged" data-hi="लाइन ड्रेन और पर्ज">Line drained & purged</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iso-barricaded">
                                <label for="iso-barricaded" data-en="Area barricaded & signage in place" data-hi="क्षेत्र बैरिकेडेड और साइनेज लगा">Area barricaded & signage in place</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iso-extinguishers">
                                <label for="iso-extinguishers" data-en="Fire extinguishers available" data-hi="फायर एक्सटिंगुइशर उपलब्ध">Fire extinguishers available</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iso-fire-watch">
                                <label for="iso-fire-watch" data-en="Fire watch assigned (if applicable)" data-hi="फायर वॉच नियुक्त (यदि लागू हो)">Fire watch assigned (if applicable)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="gasTest" data-en="Gas Test" data-hi="गैस टेस्ट">Gas Test</label>
                        <div class="checkbox-item">
                            <input type="checkbox" id="gasTest">
                            <label for="gasTest" data-en="Include Gas Test" data-hi="गैस टेस्ट शामिल करें">Include Gas Test</label>
                        </div>
                    </div>
                </div>
                
                <!-- Hazards & Controls Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #ffebee; color: #d32f2f;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h2 class="card-title" data-en="Hazards & Controls" data-hi="खतरे और नियंत्रण">Hazards & Controls</h2>
                    </div>
                    
                    <div class="workforce-container">
                        <table class="hazards-table">
                            <thead>
                                <tr>
                                    <th data-en="Hazard" data-hi="खतरा">Hazard</th>
                                    <th data-en="Control / Precaution" data-hi="नियंत्रण / सावधानी">Control / Precaution</th>
                                    <th data-en="Responsible" data-hi="जिम्मेदार">Responsible</th>
                                    <th data-en="Action" data-hi="कार्रवाई">Action</th>
                                </tr>
                            </thead>
                            <tbody id="hazardsTableBody">
                                <tr>
                                    <td><input type="text" class="hazard-input" placeholder="Enter hazard" data-en-placeholder="Enter hazard" data-hi-placeholder="खतरा दर्ज करें"></td>
                                    <td><input type="text" class="control-input" placeholder="Enter control measure" data-en-placeholder="Enter control measure" data-hi-placeholder="नियंत्रण उपाय दर्ज करें"></td>
                                    <td><input type="text" class="responsible-input" placeholder="Enter responsible person" data-en-placeholder="Enter responsible person" data-hi-placeholder="जिम्मेदार व्यक्ति दर्ज करें"></td>
                                    <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <button class="btn btn-success" id="addHazardBtn">
                        <i class="fas fa-plus"></i> <span data-en="Add Row" data-hi="पंक्ति जोड़ें">Add Row</span>
                    </button>
                </div>
                
                <!-- SIMOPS & Emergency Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #fff3e0; color: #f57c00;">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <h2 class="card-title" data-en="SIMOPS & Emergency" data-hi="सिमोप्स और आपातकाल">SIMOPS & Emergency</h2>
                    </div>
                    
                    <div class="form-group">
                        <label for="simops" data-en="SIMOPS / Interface Controls" data-hi="सिमोप्स / इंटरफेस नियंत्रण">SIMOPS / Interface Controls</label>
                        <textarea id="simops" rows="3" placeholder="Describe simultaneous operations controls" data-en-placeholder="Describe simultaneous operations controls" data-hi-placeholder="समवर्ती संचालन नियंत्रणों का वर्णन करें"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="emergency" data-en="Emergency Arrangements" data-hi="आपातकालीन व्यवस्था">Emergency Arrangements</label>
                        <textarea id="emergency" rows="3" placeholder="Describe emergency arrangements" data-en-placeholder="Describe emergency arrangements" data-hi-placeholder="आपातकालीन व्यवस्था का वर्णन करें"></textarea>
                    </div>
                </div>
                
                <!-- Notes & Signatures Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #e1f5fe; color: #0288d1;">
                            <i class="fas fa-sticky-note"></i>
                        </div>
                        <h2 class="card-title" data-en="Notes & Signatures" data-hi="नोट्स और हस्ताक्षर">Notes & Signatures</h2>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalNotes" data-en="Additional Notes" data-hi="अतिरिक्त नोट्स">Additional Notes</label>
                        <textarea id="additionalNotes" rows="3" placeholder="Enter any additional notes" data-en-placeholder="Enter any additional notes" data-hi-placeholder="कोई अतिरिक्त नोट्स दर्ज करें"></textarea>
                    </div>
                    
                    <div class="signature-grid">
                        <div class="form-group">
                            <label for="issuerSignature" data-en="Issuer (Permit Authority)" data-hi="जारीकर्ता (परमिट अथॉरिटी)">Issuer (Permit Authority)</label>
                            <input type="text" id="issuerSignature" placeholder="Enter name" data-en-placeholder="Enter name" data-hi-placeholder="नाम दर्ज करें">
                        </div>
                        <div class="form-group">
                            <label for="receiverSignature" data-en="Receiver (Supervisor)" data-hi="रिसीवर (पर्यवेक्षक)">Receiver (Supervisor)</label>
                            <input type="text" id="receiverSignature" placeholder="Enter name" data-en-placeholder="Enter name" data-hi-placeholder="नाम दर्ज करें">
                        </div>
                        <div class="form-group">
                            <label for="hseSignature" data-en="HSE Witness (optional)" data-hi="एचएसई साक्षी (वैकल्पिक)">HSE Witness (optional)</label>
                            <input type="text" id="hseSignature" placeholder="Enter name" data-en-placeholder="Enter name" data-hi-placeholder="नाम दर्ज करें">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PTW Actions Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #e1f5fe; color: #0288d1;">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h2 class="card-title" data-en="Actions" data-hi="कार्रवाइयाँ">Actions</h2>
                </div>
                <div class="form-grid">
                    <button class="btn btn-primary" id="ptwPreviewBtn">
                        <i class="fas fa-eye"></i> <span data-en="Preview" data-hi="पूर्वावलोकन">Preview</span>
                    </button>
                    <button class="btn btn-success" id="ptwDownloadBtn">
                        <i class="fas fa-download"></i> <span data-en="Download PDF" data-hi="पीडीएफ डाउनलोड करें">Download PDF</span>
                    </button>
                    <button class="btn btn-danger" id="ptwResetBtn">
                        <i class="fas fa-redo"></i> <span data-en="Reset" data-hi="रीसेट">Reset</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup Preview for Man-Hours -->
    <div class="popup-overlay" id="previewPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h1 data-en="Safe Man-Hours Report" data-hi="सुरक्षित मैन-आवर रिपोर्ट">Safe Man-Hours Report</h1>
                <button class="popup-close" id="closePopup">&times;</button>
            </div>
            
            <!-- A4 Preview Content -->
            <div class="a4-preview" id="a4Preview">
                <div class="a4-header">
                    <h1 data-en="Safe Man-Hours Report" data-hi="सुरक्षित मैन-आवर रिपोर्ट">Safe Man-Hours Report</h1>
                    <p data-en="Generated preview — review and export to PDF" data-hi="जनरेटेड प्रीव्यू — समीक्षा करें और पीडीएफ में निर्यात करें">Generated preview — review and export to PDF</p>
                    <div class="a4-date" id="previewDate"></div>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Project Information" data-hi="परियोजना जानकारी">Project Information</h2>
                    <table class="project-info-table">
                        <tr>
                            <th data-en="Project / Site" data-hi="परियोजना / साइट">Project / Site</th>
                            <td id="previewProject">--</td>
                        </tr>
                        <tr>
                            <th data-en="Client" data-hi="क्लाइंट">Client</th>
                            <td id="previewClient">--</td>
                        </tr>
                        <tr>
                            <th data-en="Location" data-hi="स्थान">Location</th>
                            <td id="previewLocation">--</td>
                        </tr>
                        <tr>
                            <th data-en="Reporting Period" data-hi="रिपोर्टिंग अवधि">Reporting Period</th>
                            <td id="previewPeriod">--</td>
                        </tr>
                        <tr>
                            <th data-en="LTI Occurred" data-hi="एलटीआई हुआ">LTI Occurred</th>
                            <td id="previewLTI">No</td>
                        </tr>
                    </table>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Workforce & Hours Summary" data-hi="कार्यबल और घंटे सारांश">Workforce & Hours Summary</h2>
                    <table class="preview-table" id="previewWorkforceTable">
                        <thead>
                            <tr>
                                <th data-en="Category / Crew" data-hi="श्रेणी / कर्मी दल">Category / Crew</th>
                                <th data-en="# Workers" data-hi="# कर्मचारी"># Workers</th>
                                <th data-en="Hours/Day" data-hi="घंटे/दिन">Hours/Day</th>
                                <th data-en="Days (No LTI)" data-hi="दिन (कोई एलटीआई नहीं)">Days (No LTI)</th>
                                <th data-en="OT Hours/Day" data-hi="ओवरटाइम घंटे/दिन">OT Hours/Day</th>
                                <th data-en="Shifts/Day" data-hi="शिफ्ट/दिन">Shifts/Day</th>
                                <th data-en="Total Hours" data-hi="कुल घंटे">Total Hours</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6" style="text-align: right; font-weight: bold;" data-en="Subtotal (This Period):" data-hi="उप-योग (इस अवधि):">Subtotal (This Period):</td>
                                <td style="font-weight: bold;" id="previewSubtotal">0</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div class="a4-grid">
                    <div class="a4-box">
                        <h3 data-en="SAFE MAN-HOURS (THIS PERIOD)" data-hi="सुरक्षित मैन-आवर (इस अवधि)">SAFE MAN-HOURS (THIS PERIOD)</h3>
                        <div class="value" id="previewSafeHours">0</div>
                    </div>
                    <div class="a4-box">
                        <h3 data-en="CARRY-OVER (BEFORE PERIOD)" data-hi="कैरी-ओवर (अवधि से पहले)">CARRY-OVER (BEFORE PERIOD)</h3>
                        <div class="value" id="previewCarryOver">0</div>
                    </div>
                    <div class="a4-box">
                        <h3 data-en="CUMULATIVE SAFE MAN-HOURS" data-hi="संचयी सुरक्षित मैन-आवर">CUMULATIVE SAFE MAN-HOURS</h3>
                        <div class="value" id="previewCumulative">0</div>
                    </div>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Milestones" data-hi="माइलस्टोन">Milestones</h2>
                    <ul class="preview-list" id="previewMilestones">
                        <!-- Will be populated by JavaScript -->
                    </ul>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Highlights / Remarks" data-hi="मुख्य बिंदु / टिप्पणियाँ">Highlights / Remarks</h2>
                    <p id="previewHighlights" data-en="- Generated by The HSE Tools – Safe Man-Hours Calculator" data-hi="- द हेल्थ सेफ्टी एनवायरनमेंट टूल्स द्वारा जनरेटेड – सुरक्षित मैन-आवर कैलकुलेटर">- Generated by The HSE Tools – Safe Man-Hours Calculator</p>
                </div>
            </div>
            
            <div class="popup-actions">
                <button class="btn btn-success" id="downloadFromPopup">
                    <i class="fas fa-download"></i> <span data-en="Download PDF" data-hi="पीडीएफ डाउनलोड करें">Download PDF</span>
                </button>
                <button class="btn btn-outline" id="closePopupBtn">
                    <i class="fas fa-times"></i> <span data-en="Close" data-hi="बंद करें">Close</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Popup Preview for PTW -->
    <div class="popup-overlay" id="ptwPreviewPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h1 data-en="Permit-to-Work (PTW)" data-hi="कार्य अनुमति (पीटीडब्ल्यू)">Permit-to-Work (PTW)</h1>
                <button class="popup-close" id="closePtwPopup">&times;</button>
            </div>
            
            <!-- A4 Preview Content -->
            <div class="a4-preview" id="ptwA4Preview">
                <div class="a4-header">
                    <h1 data-en="Permit-to-Work (PTW)" data-hi="कार्य अनुमति (पीटीडब्ल्यू)">Permit-to-Work (PTW)</h1>
                    <p data-en="Generated preview — review and export to PDF" data-hi="जनरेटेड प्रीव्यू — समीक्षा करें और पीडीएफ में निर्यात करें">Generated preview — review and export to PDF</p>
                    <div class="a4-date" id="ptwPreviewDate"></div>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Permit Information" data-hi="परमिट जानकारी">Permit Information</h2>
                    <table class="project-info-table">
                        <tr>
                            <th data-en="Permit No." data-hi="परमिट नंबर">Permit No.</th>
                            <td id="previewPermitNo">--</td>
                        </tr>
                        <tr>
                            <th data-en="Project / Site" data-hi="परियोजना / साइट">Project / Site</th>
                            <td id="previewPtwProject">--</td>
                        </tr>
                        <tr>
                            <th data-en="Work Type" data-hi="कार्य प्रकार">Work Type</th>
                            <td id="previewWorkType">--</td>
                        </tr>
                        <tr>
                            <th data-en="Client" data-hi="क्लाइंट">Client</th>
                            <td id="previewPtwClient">--</td>
                        </tr>
                        <tr>
                            <th data-en="Scope" data-hi="दायरा">Scope</th>
                            <td id="previewScope">--</td>
                        </tr>
                        <tr>
                            <th data-en="Location" data-hi="स्थान">Location</th>
                            <td id="previewPtwLocation">--</td>
                        </tr>
                        <tr>
                            <th data-en="Requestor" data-hi="अनुरोधकर्ता">Requestor</th>
                            <td id="previewRequestor">--</td>
                        </tr>
                        <tr>
                            <th data-en="Issuer" data-hi="जारीकर्ता">Issuer</th>
                            <td id="previewIssuer">--</td>
                        </tr>
                        <tr>
                            <th data-en="Supervisor" data-hi="पर्यवेक्षक">Supervisor</th>
                            <td id="previewSupervisor">--</td>
                        </tr>
                        <tr>
                            <th data-en="Approver" data-hi="अनुमोदक">Approver</th>
                            <td id="previewApprover">--</td>
                        </tr>
                        <tr>
                            <th data-en="Valid From" data-hi="मान्य से">Valid From</th>
                            <td id="previewValidFrom">--</td>
                        </tr>
                        <tr>
                            <th data-en="Valid To" data-hi="मान्य तक">Valid To</th>
                            <td id="previewValidTo">--</td>
                        </tr>
                        <tr>
                            <th data-en="Status" data-hi="स्थिति">Status</th>
                            <td id="previewStatus">--</td>
                        </tr>
                    </table>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="PPE Required" data-hi="आवश्यक पीपीई">PPE Required</h2>
                    <p id="previewPpe">--</p>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Isolations / LOTO" data-hi="आइसोलेशन / लोटो">Isolations / LOTO</h2>
                    <p id="previewIsolations">--</p>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Hazards & Controls" data-hi="खतरे और नियंत्रण">Hazards & Controls</h2>
                    <table class="preview-table" id="previewHazardsTable">
                        <thead>
                            <tr>
                                <th data-en="Hazard" data-hi="खतरा">Hazard</th>
                                <th data-en="Control / Precaution" data-hi="नियंत्रण / सावधानी">Control / Precaution</th>
                                <th data-en="Responsible" data-hi="जिम्मेदार">Responsible</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="SIMOPS / Interface Controls" data-hi="सिमोप्स / इंटरफेस नियंत्रण">SIMOPS / Interface Controls</h2>
                    <p id="previewSimops">--</p>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Emergency Arrangements" data-hi="आपातकालीन व्यवस्था">Emergency Arrangements</h2>
                    <p id="previewEmergency">--</p>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Additional Notes" data-hi="अतिरिक्त नोट्स">Additional Notes</h2>
                    <p id="previewAdditionalNotes">--</p>
                </div>
                
                <div class="a4-section">
                    <h2 data-en="Signatures (Names only)" data-hi="हस्ताक्षर (केवल नाम)">Signatures (Names only)</h2>
                    <table class="project-info-table">
                        <tr>
                            <th data-en="Issuer (Permit Authority)" data-hi="जारीकर्ता (परमिट अथॉरिटी)">Issuer (Permit Authority)</th>
                            <td id="previewIssuerSignature">--</td>
                        </tr>
                        <tr>
                            <th data-en="Receiver (Supervisor)" data-hi="रिसीवर (पर्यवेक्षक)">Receiver (Supervisor)</th>
                            <td id="previewReceiverSignature">--</td>
                        </tr>
                        <tr>
                            <th data-en="HSE Witness (optional)" data-hi="एचएसई साक्षी (वैकल्पिक)">HSE Witness (optional)</th>
                            <td id="previewHseSignature">--</td>
                        </tr>
                    </table>
                </div>
                
                <div class="a4-section" style="text-align: center; margin-top: 30px;">
                    <p data-en="Permit-to-Work (PTW) | Generated by The HSE Tools ~ PTW System" data-hi="कार्य अनुमति (पीटीडब्ल्यू) | द हेल्थ सेफ्टी एनवायरनमेंट टूल्स ~ पीटीडब्ल्यू सिस्टम द्वारा जनरेटेड">Permit-to-Work (PTW) | Generated by The HSE Tools ~ PTW System</p>
                </div>
            </div>
            
            <div class="popup-actions">
                <button class="btn btn-success" id="downloadPtwFromPopup">
                    <i class="fas fa-download"></i> <span data-en="Download PDF" data-hi="पीडीएफ डाउनलोड करें">Download PDF</span>
                </button>
                <button class="btn btn-outline" id="closePtwPopupBtn">
                    <i class="fas fa-times"></i> <span data-en="Close" data-hi="बंद करें">Close</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Translation functionality
        let currentLanguage = 'en'; // Default language
        
        // Language toggle functionality
        document.getElementById('languageToggle').addEventListener('click', function() {
            // Toggle between English and Hindi
            currentLanguage = currentLanguage === 'en' ? 'hi' : 'en';
            translatePage(currentLanguage);
        });
        
        // Function to translate the entire page
        function translatePage(language) {
            // Update all elements with data-en and data-hi attributes
            document.querySelectorAll('[data-en], [data-hi]').forEach(element => {
                if (language === 'en') {
                    // Set English text
                    if (element.hasAttribute('data-en')) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            if (element.hasAttribute('data-en-placeholder')) {
                                element.placeholder = element.getAttribute('data-en-placeholder');
                            }
                            if (element.hasAttribute('data-en-value')) {
                                element.value = element.getAttribute('data-en-value');
                            }
                        } else if (element.tagName === 'OPTION') {
                            element.textContent = element.getAttribute('data-en');
                        } else {
                            element.textContent = element.getAttribute('data-en');
                        }
                    }
                } else {
                    // Set Hindi text
                    if (element.hasAttribute('data-hi')) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            if (element.hasAttribute('data-hi-placeholder')) {
                                element.placeholder = element.getAttribute('data-hi-placeholder');
                            }
                            if (element.hasAttribute('data-hi-value')) {
                                element.value = element.getAttribute('data-hi-value');
                            }
                        } else if (element.tagName === 'OPTION') {
                            element.textContent = element.getAttribute('data-hi');
                        } else {
                            element.textContent = element.getAttribute('data-hi');
                        }
                    }
                }
            });
            
            // Update the language toggle button text
            const toggleBtn = document.getElementById('languageToggle');
            const toggleText = toggleBtn.querySelector('span');
            if (language === 'en') {
                toggleText.textContent = 'EN/HI';
            } else {
                toggleText.textContent = 'अंग्रेजी/हिंदी';
            }
            
            // Update previews if they are open
            if (document.getElementById('previewPopup').style.display === 'flex') {
                updatePreview();
            }
            if (document.getElementById('ptwPreviewPopup').style.display === 'flex') {
                updatePtwPreview();
            }
        }
        
        // Set current date for preview
        document.getElementById('previewDate').textContent = new Date().toLocaleString();
        document.getElementById('ptwPreviewDate').textContent = new Date().toLocaleString();
        
        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(`${tabId}-content`).classList.add('active');
            });
        });
        
        // Theme toggle functionality
        document.getElementById('themeToggle').addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            const icon = this.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                this.querySelector('span').textContent = currentLanguage === 'en' ? 'Light/Dark' : 'लाइट/डार्क';
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                this.querySelector('span').textContent = currentLanguage === 'en' ? 'Dark/Light' : 'डार्क/लाइट';
            }
        });
        
        // Permit template selection
        document.querySelectorAll('.permit-template').forEach(template => {
            template.addEventListener('click', function() {
                // Remove active class from all templates
                document.querySelectorAll('.permit-template').forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked template
                this.classList.add('active');
                
                // Set work type based on template
                const templateType = this.getAttribute('data-template');
                const workTypeElement = document.getElementById('workType');
                if (currentLanguage === 'en') {
                    workTypeElement.value = this.textContent.trim();
                } else {
                    // For Hindi, we need to get the Hindi value
                    const hindiValue = this.querySelector('div').getAttribute('data-hi');
                    workTypeElement.value = hindiValue;
                }
                
                // In a real application, you would load template-specific data here
            });
        });
        
        // Add Row functionality for workforce
        document.getElementById('addRowBtn').addEventListener('click', function() {
            const tableBody = document.getElementById('workforceTableBody');
            const newRow = document.createElement('tr');
            
            const placeholderText = currentLanguage === 'en' ? 
                {category: 'Category/Crew', workers: 'Workers', hours: 'Hours', days: 'Days', ot: 'OT Hours', shifts: 'Shifts'} :
                {category: 'श्रेणी/कर्मी दल', workers: 'कर्मचारी', hours: 'घंटे', days: 'दिन', ot: 'ओवरटाइम घंटे', shifts: 'शिफ्ट'};
            
            newRow.innerHTML = `
                <td><input type="text" class="crew-input" placeholder="${placeholderText.category}"></td>
                <td><input type="number" class="workers-input" value="0" placeholder="${placeholderText.workers}"></td>
                <td><input type="number" class="hours-input" value="8" placeholder="${placeholderText.hours}"></td>
                <td><input type="number" class="days-input" value="0" placeholder="${placeholderText.days}"></td>
                <td><input type="number" class="ot-input" value="0" placeholder="${placeholderText.ot}"></td>
                <td><input type="number" class="shifts-input" value="1" placeholder="${placeholderText.shifts}"></td>
                <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
            `;
            
            tableBody.appendChild(newRow);
            
            // Add event listener to the new remove button
            newRow.querySelector('.remove-btn').addEventListener('click', function() {
                tableBody.removeChild(newRow);
                updateCumulativeHours();
            });
            
            // Add event listeners to inputs for auto-calculation
            const inputs = newRow.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', updateCumulativeHours);
            });
        });
        
        // Add Row functionality for hazards
        document.getElementById('addHazardBtn').addEventListener('click', function() {
            const tableBody = document.getElementById('hazardsTableBody');
            const newRow = document.createElement('tr');
            
            const placeholderText = currentLanguage === 'en' ? 
                {hazard: 'Enter hazard', control: 'Enter control measure', responsible: 'Enter responsible person'} :
                {hazard: 'खतरा दर्ज करें', control: 'नियंत्रण उपाय दर्ज करें', responsible: 'जिम्मेदार व्यक्ति दर्ज करें'};
            
            newRow.innerHTML = `
                <td><input type="text" class="hazard-input" placeholder="${placeholderText.hazard}"></td>
                <td><input type="text" class="control-input" placeholder="${placeholderText.control}"></td>
                <td><input type="text" class="responsible-input" placeholder="${placeholderText.responsible}"></td>
                <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
            `;
            
            tableBody.appendChild(newRow);
            
            // Add event listener to the new remove button
            newRow.querySelector('.remove-btn').addEventListener('click', function() {
                tableBody.removeChild(newRow);
            });
        });
        
        // Add event listeners to existing remove buttons
        document.querySelectorAll('.remove-btn').forEach(button => {
            button.addEventListener('click', function() {
                const row = this.closest('tr');
                row.parentNode.removeChild(row);
                if (row.closest('#workforceTableBody')) {
                    updateCumulativeHours();
                }
            });
        });
        
        // Add event listeners to inputs for auto-calculation
        document.querySelectorAll('#workforceTableBody input').forEach(input => {
            input.addEventListener('input', updateCumulativeHours);
        });
        
        // Apply Template functionality
        document.getElementById('applyTemplateBtn').addEventListener('click', function() {
            const template = document.getElementById('templateSelect').value;
            if (template !== '– Choose –') {
                alert(currentLanguage === 'en' ? `Applying ${template}...` : `${template} लागू कर रहे हैं...`);
                // In a real application, this would populate the form with template data
                if (template === 'Construction Template') {
                    document.getElementById('projectName').value = 'Commercial Building Construction';
                    document.getElementById('location').value = 'New York, USA';
                    document.getElementById('client').value = 'ABC Construction Inc.';
                } else if (template === 'Manufacturing Template') {
                    document.getElementById('projectName').value = 'Automotive Parts Manufacturing';
                    document.getElementById('location').value = 'Detroit, USA';
                    document.getElementById('client').value = 'XYZ Automotive Ltd.';
                }
                updateCumulativeHours();
            } else {
                alert(currentLanguage === 'en' ? 'Please select a template first.' : 'कृपया पहले एक टेम्पलेट चुनें।');
            }
        });
        
        // Calculate cumulative hours
        function updateCumulativeHours() {
            const rows = document.querySelectorAll('#workforceTableBody tr');
            let totalHours = 0;
            
            rows.forEach(row => {
                const workers = parseInt(row.querySelector('.workers-input').value) || 0;
                const hours = parseInt(row.querySelector('.hours-input').value) || 0;
                const days = parseInt(row.querySelector('.days-input').value) || 0;
                const ot = parseInt(row.querySelector('.ot-input').value) || 0;
                const shifts = parseInt(row.querySelector('.shifts-input').value) || 1;
                
                const rowHours = workers * (hours + ot) * days * shifts;
                totalHours += rowHours;
            });
            
            const previousHours = parseInt(document.getElementById('previousHours').value) || 0;
            const cumulativeHours = totalHours + previousHours;
            
            document.getElementById('cumulativeHours').value = cumulativeHours.toLocaleString();
        }
        
        // Preview functionality for man-hours
        function updatePreview() {
            // Update project details
            document.getElementById('previewProject').textContent = 
                document.getElementById('projectName').value || '--';
            document.getElementById('previewClient').textContent = 
                document.getElementById('client').value || '--';
            document.getElementById('previewLocation').textContent = 
                document.getElementById('location').value || '--';
            
            // Update period
            const from = document.getElementById('periodFrom').value;
            const to = document.getElementById('periodTo').value;
            document.getElementById('previewPeriod').textContent = 
                (from && to) ? `${from} to ${to}` : '--';
            
            // Update LTI status
            const ltiYes = document.getElementById('lti-yes').checked;
            document.getElementById('previewLTI').textContent = ltiYes ? 
                (currentLanguage === 'en' ? 'Yes' : 'हाँ') : 
                (currentLanguage === 'en' ? 'No' : 'नहीं');
            
            // Update workforce table in preview
            const previewTable = document.getElementById('previewWorkforceTable').getElementsByTagName('tbody')[0];
            previewTable.innerHTML = '';
            
            const rows = document.querySelectorAll('#workforceTableBody tr');
            let totalHours = 0;
            
            rows.forEach(row => {
                const crew = row.querySelector('.crew-input').value || '--';
                const workers = parseInt(row.querySelector('.workers-input').value) || 0;
                const hours = parseInt(row.querySelector('.hours-input').value) || 0;
                const days = parseInt(row.querySelector('.days-input').value) || 0;
                const ot = parseInt(row.querySelector('.ot-input').value) || 0;
                const shifts = parseInt(row.querySelector('.shifts-input').value) || 1;
                
                const rowHours = workers * (hours + ot) * days * shifts;
                totalHours += rowHours;
                
                const newRow = previewTable.insertRow();
                newRow.innerHTML = `
                    <td>${crew}</td>
                    <td>${workers}</td>
                    <td>${hours}</td>
                    <td>${days}</td>
                    <td>${ot}</td>
                    <td>${shifts}</td>
                    <td>${rowHours.toLocaleString()}</td>
                `;
            });
            
            // Update totals
            document.getElementById('previewSubtotal').textContent = totalHours.toLocaleString();
            document.getElementById('previewSafeHours').textContent = totalHours.toLocaleString();
            
            // Update carry-over and cumulative
            const previousHours = parseInt(document.getElementById('previousHours').value) || 0;
            document.getElementById('previewCarryOver').textContent = previousHours.toLocaleString();
            document.getElementById('previewCumulative').textContent = (totalHours + previousHours).toLocaleString();
            
            // Update milestones
            const milestonesList = document.getElementById('previewMilestones');
            milestonesList.innerHTML = '';
            
            if (totalHours >= 10000) {
                const milestone = document.createElement('li');
                milestone.textContent = currentLanguage === 'en' ? 
                    'Achieved 10,000 Safe Man-Hours without LTI' : 
                    'एलटीआई के बिना 10,000 सुरक्षित मैन-आवर प्राप्त किए';
                milestonesList.appendChild(milestone);
            }
            
            if (totalHours >= 50000) {
                const milestone = document.createElement('li');
                milestone.textContent = currentLanguage === 'en' ? 
                    'Achieved 50,000 Safe Man-Hours without LTI' : 
                    'एलटीआई के बिना 50,000 सुरक्षित मैन-आवर प्राप्त किए';
                milestonesList.appendChild(milestone);
            }
            
            // Update highlights
            const highlights = document.getElementById('highlights').value;
            document.getElementById('previewHighlights').textContent = 
                highlights || (currentLanguage === 'en' ? 
                    '- Generated by The HSE Tools – Safe Man-Hours Calculator' : 
                    '- द हेल्थ सेफ्टी एनवायरनमेंट टूल्स द्वारा जनरेटेड – सुरक्षित मैन-आवर कैलकुलेटर');
        }
        
        // Preview functionality for PTW
        function updatePtwPreview() {
            // Update permit details
            document.getElementById('previewPermitNo').textContent = 
                document.getElementById('permitNo').value || '--';
            document.getElementById('previewPtwProject').textContent = 
                document.getElementById('ptwProjectName').value || '--';
            document.getElementById('previewWorkType').textContent = 
                document.getElementById('workType').value || '--';
            document.getElementById('previewPtwClient').textContent = 
                document.getElementById('ptwClient').value || '--';
            document.getElementById('previewScope').textContent = 
                document.getElementById('workDescription').value || '--';
            document.getElementById('previewPtwLocation').textContent = 
                document.getElementById('ptwLocation').value || '--';
            document.getElementById('previewRequestor').textContent = 
                document.getElementById('requestedBy').value || '--';
            document.getElementById('previewIssuer').textContent = 
                document.getElementById('issuer').value || '--';
            document.getElementById('previewSupervisor').textContent = 
                document.getElementById('supervisor').value || '--';
            document.getElementById('previewApprover').textContent = 
                document.getElementById('approver').value || '--';
            document.getElementById('previewValidFrom').textContent = 
                document.getElementById('validFrom').value || '--';
            document.getElementById('previewValidTo').textContent = 
                document.getElementById('validTo').value || '--';
            
            // Update status
            const status = document.getElementById('permitStatus').value;
            let statusText = '--';
            if (status === 'open') statusText = currentLanguage === 'en' ? 'Open' : 'खुला';
            else if (status === 'closed') statusText = currentLanguage === 'en' ? 'Closed' : 'बंद';
            else if (status === 'suspended') statusText = currentLanguage === 'en' ? 'Suspended' : 'निलंबित';
            else if (status === 'cancelled') statusText = currentLanguage === 'en' ? 'Cancelled' : 'रद्द';
            document.getElementById('previewStatus').textContent = statusText;
            
            // Update PPE
            const ppeCheckboxes = document.querySelectorAll('input[id^="ppe-"]:checked');
            const ppeItems = Array.from(ppeCheckboxes).map(cb => {
                return currentLanguage === 'en' ? 
                    cb.nextElementSibling.getAttribute('data-en') : 
                    cb.nextElementSibling.getAttribute('data-hi');
            });
            document.getElementById('previewPpe').textContent = 
                ppeItems.length > 0 ? ppeItems.join(', ') : '--';
            
            // Update isolations
            const isoCheckboxes = document.querySelectorAll('input[id^="iso-"]:checked');
            const isoItems = Array.from(isoCheckboxes).map(cb => {
                return currentLanguage === 'en' ? 
                    cb.nextElementSibling.getAttribute('data-en') : 
                    cb.nextElementSibling.getAttribute('data-hi');
            });
            document.getElementById('previewIsolations').textContent = 
                isoItems.length > 0 ? isoItems.join(', ') : '--';
            
            // Update hazards table
            const hazardsTable = document.getElementById('previewHazardsTable').getElementsByTagName('tbody')[0];
            hazardsTable.innerHTML = '';
            
            const hazardRows = document.querySelectorAll('#hazardsTableBody tr');
            hazardRows.forEach(row => {
                const hazard = row.querySelector('.hazard-input').value || '--';
                const control = row.querySelector('.control-input').value || '--';
                const responsible = row.querySelector('.responsible-input').value || '--';
                
                const newRow = hazardsTable.insertRow();
                newRow.innerHTML = `
                    <td>${hazard}</td>
                    <td>${control}</td>
                    <td>${responsible}</td>
                `;
            });
            
            // Update SIMOPS and emergency
            document.getElementById('previewSimops').textContent = 
                document.getElementById('simops').value || '--';
            document.getElementById('previewEmergency').textContent = 
                document.getElementById('emergency').value || '--';
            document.getElementById('previewAdditionalNotes').textContent = 
                document.getElementById('additionalNotes').value || '--';
            
            // Update signatures
            document.getElementById('previewIssuerSignature').textContent = 
                document.getElementById('issuerSignature').value || '--';
            document.getElementById('previewReceiverSignature').textContent = 
                document.getElementById('receiverSignature').value || '--';
            document.getElementById('previewHseSignature').textContent = 
                document.getElementById('hseSignature').value || '--';
        }
        
        // Popup functionality
        function openPopup() {
            updatePreview();
            document.getElementById('previewPopup').style.display = 'flex';
        }
        
        function openPtwPopup() {
            updatePtwPreview();
            document.getElementById('ptwPreviewPopup').style.display = 'flex';
        }
        
        function closePopup() {
            document.getElementById('previewPopup').style.display = 'none';
        }
        
        function closePtwPopup() {
            document.getElementById('ptwPreviewPopup').style.display = 'none';
        }
        
        // Add event listeners for preview buttons
        document.getElementById('previewBtn').addEventListener('click', openPopup);
        document.getElementById('ptwPreviewBtn').addEventListener('click', openPtwPopup);
        
        // Close popup events
        document.getElementById('closePopup').addEventListener('click', closePopup);
        document.getElementById('closePopupBtn').addEventListener('click', closePopup);
        document.getElementById('closePtwPopup').addEventListener('click', closePtwPopup);
        document.getElementById('closePtwPopupBtn').addEventListener('click', closePtwPopup);
        
        // Close popup when clicking outside
        document.getElementById('previewPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                closePopup();
            }
        });
        
        document.getElementById('ptwPreviewPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                closePtwPopup();
            }
        });
        
        // PDF Download functionality using html2canvas and jsPDF
        function downloadPDF() {
            showLoadingIndicator();
            
            updatePreview();
            const element = document.getElementById('a4Preview');
            
            // Use html2canvas to convert the element to an image
            html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                // Convert canvas to image data
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                
                // Create PDF using jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Calculate dimensions to fit the image in A4
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                // Add first page
                pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Add additional pages if content is longer than one page
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Save the PDF
                pdf.save('safe-man-hours-report.pdf');
                hideLoadingIndicator();
            }).catch(error => {
                console.error('Error generating PDF:', error);
                hideLoadingIndicator();
                alert(currentLanguage === 'en' ? 
                    'Error generating PDF. Please try again.' : 
                    'पीडीएफ जनरेट करने में त्रुटि। कृपया पुनः प्रयास करें।');
            });
        }
        
        // PDF Download functionality for PTW using html2canvas and jsPDF
        function downloadPtwPDF() {
            showLoadingIndicator();
            
            updatePtwPreview();
            const element = document.getElementById('ptwA4Preview');
            
            // Use html2canvas to convert the element to an image
            html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                // Convert canvas to image data
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                
                // Create PDF using jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Calculate dimensions to fit the image in A4
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                // Add first page
                pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Add additional pages if content is longer than one page
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Save the PDF
                pdf.save('permit-to-work.pdf');
                hideLoadingIndicator();
            }).catch(error => {
                console.error('Error generating PDF:', error);
                hideLoadingIndicator();
                alert(currentLanguage === 'en' ? 
                    'Error generating PDF. Please try again.' : 
                    'पीडीएफ जनरेट करने में त्रुटि। कृपया पुनः प्रयास करें।');
            });
        }
        
        // Loading indicator functions
        function showLoadingIndicator() {
            document.getElementById('loadingIndicator').style.display = 'flex';
        }
        
        function hideLoadingIndicator() {
            document.getElementById('loadingIndicator').style.display = 'none';
        }
        
        // Add event listeners for download buttons
        document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
        document.getElementById('downloadFromPopup').addEventListener('click', downloadPDF);
        document.getElementById('ptwDownloadBtn').addEventListener('click', downloadPtwPDF);
        document.getElementById('downloadPtwFromPopup').addEventListener('click', downloadPtwPDF);
        
        // Reset functionality for man-hours
        function resetForm() {
            document.querySelectorAll('#man-hours-content input, #man-hours-content textarea, #man-hours-content select').forEach(element => {
                if (element.type !== 'button' && element.type !== 'submit') {
                    element.value = '';
                }
            });
            
            // Reset LTI to No
            document.getElementById('lti-no').checked = true;
            
            // Reset workforce table to one row
            const tableBody = document.getElementById('workforceTableBody');
            tableBody.innerHTML = `
                <tr>
                    <td><input type="text" class="crew-input" value="General Workforce" placeholder="${currentLanguage === 'en' ? 'Category/Crew' : 'श्रेणी/कर्मी दल'}"></td>
                    <td><input type="number" class="workers-input" value="100" placeholder="${currentLanguage === 'en' ? 'Workers' : 'कर्मचारी'}"></td>
                    <td><input type="number" class="hours-input" value="8" placeholder="${currentLanguage === 'en' ? 'Hours' : 'घंटे'}"></td>
                    <td><input type="number" class="days-input" value="26" placeholder="${currentLanguage === 'en' ? 'Days' : 'दिन'}"></td>
                    <td><input type="number" class="ot-input" value="0" placeholder="${currentLanguage === 'en' ? 'OT Hours' : 'ओवरटाइम घंटे'}"></td>
                    <td><input type="number" class="shifts-input" value="1" placeholder="${currentLanguage === 'en' ? 'Shifts' : 'शिफ्ट'}"></td>
                    <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
                </tr>
            `;
            
            // Reattach event listener to the remove button
            document.querySelector('#workforceTableBody .remove-btn').addEventListener('click', function() {
                const row = this.closest('tr');
                row.parentNode.removeChild(row);
                updateCumulativeHours();
            });
            
            // Reattach event listeners to inputs
            document.querySelectorAll('#workforceTableBody input').forEach(input => {
                input.addEventListener('input', updateCumulativeHours);
            });
            
            updateCumulativeHours();
            updatePreview();
        }
        
        // Reset functionality for PTW
        function resetPtwForm() {
            document.querySelectorAll('#permit-content input, #permit-content textarea, #permit-content select').forEach(element => {
                if (element.type !== 'button' && element.type !== 'submit' && element.id !== 'permitNo') {
                    if (element.type === 'checkbox') {
                        element.checked = false;
                    } else {
                        element.value = '';
                    }
                }
            });
            
            // Reset permit number to default
            document.getElementById('permitNo').value = 'PTW-251101-178';
            
            // Reset work type to default
            document.getElementById('workType').value = currentLanguage === 'en' ? 'Hot Work' : 'हॉट वर्क';
            
            // Reset permit status to default
            document.getElementById('permitStatus').value = 'open';
            
            // Reset hazards table to one row
            const hazardsTableBody = document.getElementById('hazardsTableBody');
            const placeholderText = currentLanguage === 'en' ? 
                {hazard: 'Enter hazard', control: 'Enter control measure', responsible: 'Enter responsible person'} :
                {hazard: 'खतरा दर्ज करें', control: 'नियंत्रण उपाय दर्ज करें', responsible: 'जिम्मेदार व्यक्ति दर्ज करें'};
            
            hazardsTableBody.innerHTML = `
                <tr>
                    <td><input type="text" class="hazard-input" placeholder="${placeholderText.hazard}"></td>
                    <td><input type="text" class="control-input" placeholder="${placeholderText.control}"></td>
                    <td><input type="text" class="responsible-input" placeholder="${placeholderText.responsible}"></td>
                    <td><button class="remove-btn"><i class="fas fa-trash"></i></button></td>
                </tr>
            `;
            
            // Reattach event listener to the remove button
            document.querySelector('#hazardsTableBody .remove-btn').addEventListener('click', function() {
                const row = this.closest('tr');
                row.parentNode.removeChild(row);
            });
            
            // Reset template selection
            document.querySelectorAll('.permit-template').forEach(t => t.classList.remove('active'));
            
            updatePtwPreview();
        }
        
        document.getElementById('resetBtn').addEventListener('click', resetForm);
        document.getElementById('ptwResetBtn').addEventListener('click', resetPtwForm);
        
        // Initialize cumulative hours on page load
        updateCumulativeHours();
    </script>
</body>
</html>