<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toolbox Talk (TBT) Generator | Safety Meeting Documentation</title>
    <meta name="description" content="Generate professional Toolbox Talk reports for workplace safety meetings. Document hazards, controls, and attendees easily.">
    <meta name="keywords" content="toolbox talk, TBT, safety meeting, workplace safety, hazard assessment, safety documentation">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3c4e;
            --text-color: #333;
            --bg-color: #fff;
            --card-bg: #f8f9fa;
            --border-color: #ddd;
        }

        .dark-mode {
            --primary-color: #34495e;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --danger-color: #c0392b;
            --warning-color: #e67e22;
            --light-color: #2c3e50;
            --dark-color: #1a252f;
            --text-color: #ecf0f1;
            --bg-color: #1e2a3a;
            --card-bg: #2c3c4e;
            --border-color: #34495e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 10px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-light {
            background-color: var(--light-color);
            color: var(--text-color);
        }

        .form-section {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .dynamic-list {
            margin-top: 10px;
        }

        .list-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .list-item input {
            flex: 1;
        }

        .remove-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .add-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            margin-top: 10px;
        }

        .hazard-control-pair {
            background-color: var(--bg-color);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }

        .pair-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        .preview-section {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .preview-table th, .preview-table td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
        }

        .preview-table th {
            background-color: var(--primary-color);
            color: white;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .header-controls {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }
            
            .list-item {
                flex-direction: column;
                align-items: stretch;
            }
            
            .pair-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Toolbox Talk (TBT) Generator</h1>
                <p>Document safety meetings, hazards, controls, and attendees</p>
            </div>
            <div class="header-controls">
                <button id="translateBtn" class="btn-light">
                    <span class="lang-text">हिंदी</span>
                </button>
                <button id="darkModeBtn" class="btn-light">
                    <span class="mode-text">Dark Mode</span>
                </button>
                <button id="previewBtn" class="btn-primary">Preview</button>
                <button id="downloadBtn" class="btn-success">Download PDF</button>
                <button id="resetBtn" class="btn-danger">Reset</button>
            </div>
        </header>

        <main>
            <div id="formView">
                <div class="form-section">
                    <h2>Session Details</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="project">Project / Task</label>
                            <input type="text" id="project" placeholder="Enter project or task name">
                        </div>
                        <div class="form-group">
                            <label for="topic">Topic</label>
                            <input type="text" id="topic" placeholder="Enter discussion topic">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="location">Location</label>
                            <input type="text" id="location" placeholder="Enter location">
                        </div>
                        <div class="form-group">
                            <label for="dateTime">Date & Time</label>
                            <input type="datetime-local" id="dateTime" value="2025-11-01T16:58">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conductedBy">Conducted by</label>
                            <input type="text" id="conductedBy" placeholder="Facilitator name">
                        </div>
                        <div class="form-group">
                            <label for="duration">Duration (minutes)</label>
                            <input type="number" id="duration" placeholder="15" value="15">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Attendees</h2>
                    <div class="form-group">
                        <label>Add attendees (name, contact, trade/role)</label>
                        <div class="dynamic-list" id="attendeesList">
                            <div class="list-item">
                                <input type="text" placeholder="Name">
                                <input type="text" placeholder="Contact">
                                <input type="text" placeholder="Trade/Role">
                                <button class="remove-btn">×</button>
                            </div>
                        </div>
                        <button class="add-btn" id="addAttendee">Add Attendee</button>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Hazards & Controls</h2>
                    <div id="hazardsList">
                        <div class="hazard-control-pair">
                            <div class="pair-header">
                                <h3>Hazard & Control #1</h3>
                                <button class="remove-btn remove-hazard">Remove</button>
                            </div>
                            <div class="form-group">
                                <label>Hazard Identification</label>
                                <textarea placeholder="Describe the potential hazard"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Control Measures</label>
                                <textarea placeholder="Describe safety controls and procedures"></textarea>
                            </div>
                        </div>
                    </div>
                    <button class="add-btn" id="addHazard">Add Hazard & Control</button>
                </div>

                <div class="form-section">
                    <h2>Key Discussion Points</h2>
                    <div class="form-group">
                        <textarea id="discussionPoints" placeholder="Enter key discussion points, safety reminders, and important information shared during the talk"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Additional Notes</h2>
                    <div class="form-group">
                        <textarea id="additionalNotes" placeholder="Enter any additional notes, observations, or follow-up actions"></textarea>
                    </div>
                </div>
            </div>

            <div id="previewView" class="hidden">
                <div class="preview-section">
                    <h2>Toolbox Talk (TBT) Report Preview</h2>
                    <div class="header-controls">
                        <button id="backToFormBtn" class="btn-primary">Back to Form</button>
                        <button id="downloadFromPreviewBtn" class="btn-success">Download PDF</button>
                    </div>
                    <div id="previewContent"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Translation data
        const translations = {
            en: {
                title: "Toolbox Talk (TBT) Generator",
                subtitle: "Document safety meetings, hazards, controls, and attendees",
                project: "Project / Task",
                topic: "Topic",
                location: "Location",
                dateTime: "Date & Time",
                conductedBy: "Conducted by",
                duration: "Duration (minutes)",
                attendees: "Attendees",
                addAttendee: "Add Attendee",
                name: "Name",
                contact: "Contact",
                tradeRole: "Trade/Role",
                hazardsControls: "Hazards & Controls",
                addHazard: "Add Hazard & Control",
                hazardIdentification: "Hazard Identification",
                controlMeasures: "Control Measures",
                discussionPoints: "Key Discussion Points",
                additionalNotes: "Additional Notes",
                preview: "Preview",
                downloadPDF: "Download PDF",
                reset: "Reset",
                backToForm: "Back to Form",
                remove: "Remove",
                toolboxTalkReport: "Toolbox Talk (TBT) Report",
                sessionDetails: "Session Details",
                hazardsAndControls: "Hazards & Controls",
                keyDiscussion: "Key Discussion Points",
                notes: "Additional Notes",
                noAttendees: "No attendees recorded",
                noHazards: "No hazards identified",
                generatedOn: "Generated on",
                generatedBy: "Generated by The HSE Tools - Toolbox Talk Generator"
            },
            hi: {
                title: "टूलबॉक्स टॉक (TBT) जनरेटर",
                subtitle: "सुरक्षा बैठकों, खतरों, नियंत्रणों और उपस्थित लोगों को दस्तावेज करें",
                project: "परियोजना / कार्य",
                topic: "विषय",
                location: "स्थान",
                dateTime: "दिनांक और समय",
                conductedBy: "द्वारा आयोजित",
                duration: "अवधि (मिनट)",
                attendees: "उपस्थित लोग",
                addAttendee: "उपस्थिति जोड़ें",
                name: "नाम",
                contact: "संपर्क",
                tradeRole: "व्यापार/भूमिका",
                hazardsControls: "खतरे और नियंत्रण",
                addHazard: "खतरा और नियंत्रण जोड़ें",
                hazardIdentification: "खतरे की पहचान",
                controlMeasures: "नियंत्रण उपाय",
                discussionPoints: "मुख्य चर्चा बिंदु",
                additionalNotes: "अतिरिक्त नोट्स",
                preview: "पूर्वावलोकन",
                downloadPDF: "PDF डाउनलोड करें",
                reset: "रीसेट",
                backToForm: "फॉर्म पर वापस जाएं",
                remove: "हटाएं",
                toolboxTalkReport: "टूलबॉक्स टॉक (TBT) रिपोर्ट",
                sessionDetails: "सत्र विवरण",
                hazardsAndControls: "खतरे और नियंत्रण",
                keyDiscussion: "मुख्य चर्चा बिंदु",
                notes: "अतिरिक्त नोट्स",
                noAttendees: "कोई उपस्थिति दर्ज नहीं की गई",
                noHazards: "कोई खतरा पहचाना नहीं गया",
                generatedOn: "पर जनरेट किया गया",
                generatedBy: "द एचएसई टूल्स - टूलबॉक्स टॉक जनरेटर द्वारा जनरेट किया गया"
            }
        };

        // State management
        let state = {
            isHindi: false,
            isDarkMode: false
        };

        // Initialize the application
        function init() {
            setupEventListeners();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Mode and language toggles
            document.getElementById('translateBtn').addEventListener('click', toggleLanguage);
            document.getElementById('darkModeBtn').addEventListener('click', toggleDarkMode);
            
            // Main buttons
            document.getElementById('previewBtn').addEventListener('click', showPreview);
            document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
            document.getElementById('resetBtn').addEventListener('click', resetForm);
            
            // Preview buttons
            document.getElementById('backToFormBtn').addEventListener('click', backToForm);
            document.getElementById('downloadFromPreviewBtn').addEventListener('click', downloadPDF);
            
            // Dynamic list management
            document.getElementById('addAttendee').addEventListener('click', addAttendee);
            document.getElementById('addHazard').addEventListener('click', addHazard);
            
            // Delegated event listeners for dynamic elements
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-btn')) {
                    if (e.target.classList.contains('remove-hazard')) {
                        e.target.closest('.hazard-control-pair').remove();
                        updateHazardNumbers();
                    } else {
                        e.target.closest('.list-item').remove();
                    }
                }
            });
        }

        // Add attendee row
        function addAttendee() {
            const lang = state.isHindi ? translations.hi : translations.en;
            const attendeesList = document.getElementById('attendeesList');
            const newItem = document.createElement('div');
            newItem.className = 'list-item';
            newItem.innerHTML = `
                <input type="text" placeholder="${lang.name}">
                <input type="text" placeholder="${lang.contact}">
                <input type="text" placeholder="${lang.tradeRole}">
                <button class="remove-btn">×</button>
            `;
            attendeesList.appendChild(newItem);
        }

        // Add hazard-control pair
        function addHazard() {
            const lang = state.isHindi ? translations.hi : translations.en;
            const hazardsList = document.getElementById('hazardsList');
            const hazardCount = hazardsList.children.length + 1;
            
            const newHazard = document.createElement('div');
            newHazard.className = 'hazard-control-pair';
            newHazard.innerHTML = `
                <div class="pair-header">
                    <h3>${lang.hazardsControls} #${hazardCount}</h3>
                    <button class="remove-btn remove-hazard">${lang.remove}</button>
                </div>
                <div class="form-group">
                    <label>${lang.hazardIdentification}</label>
                    <textarea placeholder="${lang.hazardIdentification}"></textarea>
                </div>
                <div class="form-group">
                    <label>${lang.controlMeasures}</label>
                    <textarea placeholder="${lang.controlMeasures}"></textarea>
                </div>
            `;
            hazardsList.appendChild(newHazard);
        }

        // Update hazard numbers after removal
        function updateHazardNumbers() {
            const hazards = document.querySelectorAll('.hazard-control-pair');
            const lang = state.isHindi ? translations.hi : translations.en;
            
            hazards.forEach((hazard, index) => {
                hazard.querySelector('h3').textContent = `${lang.hazardsControls} #${index + 1}`;
            });
        }

        // Toggle language
        function toggleLanguage() {
            state.isHindi = !state.isHindi;
            const btn = document.getElementById('translateBtn');
            btn.querySelector('.lang-text').textContent = state.isHindi ? 'English' : 'हिंदी';
            
            // Update all text content
            updateLanguage();
        }

        // Update all text content based on current language
        function updateLanguage() {
            const lang = state.isHindi ? translations.hi : translations.en;
            
            // Update header
            document.querySelector('h1').textContent = lang.title;
            document.querySelector('header p').textContent = lang.subtitle;
            
            // Update form labels
            document.querySelector('label[for="project"]').textContent = lang.project;
            document.querySelector('label[for="topic"]').textContent = lang.topic;
            document.querySelector('label[for="location"]').textContent = lang.location;
            document.querySelector('label[for="dateTime"]').textContent = lang.dateTime;
            document.querySelector('label[for="conductedBy"]').textContent = lang.conductedBy;
            document.querySelector('label[for="duration"]').textContent = lang.duration;
            
            // Update section headers
            document.querySelectorAll('.form-section h2')[0].textContent = lang.sessionDetails;
            document.querySelectorAll('.form-section h2')[1].textContent = lang.attendees;
            document.querySelectorAll('.form-section h2')[2].textContent = lang.hazardsControls;
            document.querySelectorAll('.form-section h2')[3].textContent = lang.discussionPoints;
            document.querySelectorAll('.form-section h2')[4].textContent = lang.notes;
            
            // Update buttons
            document.getElementById('previewBtn').textContent = lang.preview;
            document.getElementById('downloadBtn').textContent = lang.downloadPDF;
            document.getElementById('resetBtn').textContent = lang.reset;
            document.getElementById('backToFormBtn').textContent = lang.backToForm;
            document.getElementById('downloadFromPreviewBtn').textContent = lang.downloadPDF;
            document.getElementById('addAttendee').textContent = lang.addAttendee;
            document.getElementById('addHazard').textContent = lang.addHazard;
            
            // Update placeholders
            document.getElementById('project').placeholder = lang.project;
            document.getElementById('topic').placeholder = lang.topic;
            document.getElementById('location').placeholder = lang.location;
            document.getElementById('conductedBy').placeholder = lang.conductedBy;
            document.getElementById('discussionPoints').placeholder = lang.discussionPoints;
            document.getElementById('additionalNotes').placeholder = lang.notes;
            
            // Update dynamic elements
            const attendeesLabel = document.querySelector('label[for="attendeesList"]');
            if (attendeesLabel) attendeesLabel.textContent = lang.attendees;
            
            // Update attendee input placeholders
            document.querySelectorAll('.list-item input').forEach((input, index) => {
                if (index % 3 === 0) input.placeholder = lang.name;
                else if (index % 3 === 1) input.placeholder = lang.contact;
                else input.placeholder = lang.tradeRole;
            });
            
            // Update hazard textareas
            document.querySelectorAll('.hazard-control-pair textarea').forEach((textarea, index) => {
                if (index % 2 === 0) textarea.placeholder = lang.hazardIdentification;
                else textarea.placeholder = lang.controlMeasures;
            });
            
            // Update hazard headers
            updateHazardNumbers();
        }

        // Toggle dark mode
        function toggleDarkMode() {
            state.isDarkMode = !state.isDarkMode;
            const btn = document.getElementById('darkModeBtn');
            
            if (state.isDarkMode) {
                document.body.classList.add('dark-mode');
                btn.querySelector('.mode-text').textContent = 'Light Mode';
            } else {
                document.body.classList.remove('dark-mode');
                btn.querySelector('.mode-text').textContent = 'Dark Mode';
            }
        }

        // Show preview
        function showPreview() {
            document.getElementById('formView').classList.add('hidden');
            document.getElementById('previewView').classList.remove('hidden');
            
            generatePreviewContent();
        }

        // Back to form
        function backToForm() {
            document.getElementById('formView').classList.remove('hidden');
            document.getElementById('previewView').classList.add('hidden');
        }

        // Generate preview content
        function generatePreviewContent() {
            const previewContent = document.getElementById('previewContent');
            const lang = state.isHindi ? translations.hi : translations.en;
            
            // Get form values
            const project = document.getElementById('project').value || '—';
            const topic = document.getElementById('topic').value || '—';
            const location = document.getElementById('location').value || '—';
            const dateTime = document.getElementById('dateTime').value || '—';
            const conductedBy = document.getElementById('conductedBy').value || '—';
            const duration = document.getElementById('duration').value || '—';
            const discussionPoints = document.getElementById('discussionPoints').value || '—';
            const additionalNotes = document.getElementById('additionalNotes').value || '—';
            
            // Get attendees
            const attendees = [];
            document.querySelectorAll('#attendeesList .list-item').forEach(item => {
                const inputs = item.querySelectorAll('input');
                if (inputs[0].value || inputs[1].value || inputs[2].value) {
                    attendees.push({
                        name: inputs[0].value || '—',
                        contact: inputs[1].value || '—',
                        role: inputs[2].value || '—'
                    });
                }
            });
            
            // Get hazards and controls
            const hazards = [];
            document.querySelectorAll('.hazard-control-pair').forEach(pair => {
                const textareas = pair.querySelectorAll('textarea');
                if (textareas[0].value || textareas[1].value) {
                    hazards.push({
                        hazard: textareas[0].value || '—',
                        control: textareas[1].value || '—'
                    });
                }
            });
            
            // Build preview HTML
            let html = `
                <div class="form-section">
                    <h2>${lang.toolboxTalkReport}</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>${lang.project}:</label>
                            <p>${project}</p>
                        </div>
                        <div class="form-group">
                            <label>${lang.topic}:</label>
                            <p>${topic}</p>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>${lang.location}:</label>
                            <p>${location}</p>
                        </div>
                        <div class="form-group">
                            <label>${lang.dateTime}:</label>
                            <p>${formatDateTime(dateTime)}</p>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>${lang.conductedBy}:</label>
                            <p>${conductedBy}</p>
                        </div>
                        <div class="form-group">
                            <label>${lang.duration}:</label>
                            <p>${duration} minutes</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h2>${lang.attendees}</h2>
                    ${attendees.length > 0 ? `
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>${lang.name}</th>
                                    <th>${lang.contact}</th>
                                    <th>${lang.tradeRole}</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${attendees.map(attendee => `
                                    <tr>
                                        <td>${attendee.name}</td>
                                        <td>${attendee.contact}</td>
                                        <td>${attendee.role}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : `<p>${lang.noAttendees}</p>`}
                </div>
                
                <div class="form-section">
                    <h2>${lang.hazardsAndControls}</h2>
                    ${hazards.length > 0 ? hazards.map((hazard, index) => `
                        <div class="hazard-control-pair">
                            <h3>${lang.hazardsControls} #${index + 1}</h3>
                            <div class="form-group">
                                <label>${lang.hazardIdentification}:</label>
                                <p>${hazard.hazard}</p>
                            </div>
                            <div class="form-group">
                                <label>${lang.controlMeasures}:</label>
                                <p>${hazard.control}</p>
                            </div>
                        </div>
                    `).join('') : `<p>${lang.noHazards}</p>`}
                </div>
                
                <div class="form-section">
                    <h2>${lang.keyDiscussion}</h2>
                    <p>${discussionPoints}</p>
                </div>
                
                <div class="form-section">
                    <h2>${lang.notes}</h2>
                    <p>${additionalNotes}</p>
                </div>
                
                <div class="form-section">
                    <p><em>${lang.generatedOn} ${new Date().toLocaleString()}</em></p>
                    <p><em>${lang.generatedBy}</em></p>
                </div>
            `;
            
            previewContent.innerHTML = html;
        }

        // Format date time for display
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '—';
            
            const date = new Date(dateTimeString);
            return date.toLocaleString();
        }

        // Download PDF
        function downloadPDF() {
            // Show loading indicator
            const originalText = document.querySelector('#downloadBtn').innerHTML;
            document.querySelector('#downloadBtn').innerHTML = 'Generating PDF...';
            document.querySelector('#downloadBtn').disabled = true;
            
            // Use html2canvas and jsPDF to generate PDF
            generatePDF().then(() => {
                // Restore button text
                document.querySelector('#downloadBtn').innerHTML = originalText;
                document.querySelector('#downloadBtn').disabled = false;
            }).catch(error => {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
                document.querySelector('#downloadBtn').innerHTML = originalText;
                document.querySelector('#downloadBtn').disabled = false;
            });
        }

        // Generate PDF using html2canvas and jsPDF
        async function generatePDF() {
            const lang = state.isHindi ? translations.hi : translations.en;
            
            // Create a temporary element for PDF generation
            const pdfElement = document.createElement('div');
            pdfElement.style.width = '210mm';
            pdfElement.style.padding = '20px';
            pdfElement.style.backgroundColor = 'white';
            pdfElement.style.color = 'black';
            pdfElement.style.fontFamily = 'Arial, sans-serif';
            
            // Get form values
            const project = document.getElementById('project').value || '—';
            const topic = document.getElementById('topic').value || '—';
            const location = document.getElementById('location').value || '—';
            const dateTime = document.getElementById('dateTime').value || '—';
            const conductedBy = document.getElementById('conductedBy').value || '—';
            const duration = document.getElementById('duration').value || '—';
            const discussionPoints = document.getElementById('discussionPoints').value || '—';
            const additionalNotes = document.getElementById('additionalNotes').value || '—';
            
            // Get attendees
            const attendees = [];
            document.querySelectorAll('#attendeesList .list-item').forEach(item => {
                const inputs = item.querySelectorAll('input');
                if (inputs[0].value || inputs[1].value || inputs[2].value) {
                    attendees.push({
                        name: inputs[0].value || '—',
                        contact: inputs[1].value || '—',
                        role: inputs[2].value || '—'
                    });
                }
            });
            
            // Get hazards and controls
            const hazards = [];
            document.querySelectorAll('.hazard-control-pair').forEach(pair => {
                const textareas = pair.querySelectorAll('textarea');
                if (textareas[0].value || textareas[1].value) {
                    hazards.push({
                        hazard: textareas[0].value || '—',
                        control: textareas[1].value || '—'
                    });
                }
            });
            
            // Build PDF content
            let html = `
                <h1 style="text-align: center; color: #2c3e50; margin-bottom: 10px;">${lang.toolboxTalkReport}</h1>
                <p style="text-align: center; margin-bottom: 20px;">${lang.subtitle}</p>
                
                <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;">${lang.sessionDetails}</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                        <tr>
                            <td style="width: 50%; padding: 5px;"><strong>${lang.project}:</strong> ${project}</td>
                            <td style="width: 50%; padding: 5px;"><strong>${lang.topic}:</strong> ${topic}</td>
                        </tr>
                        <tr>
                            <td style="width: 50%; padding: 5px;"><strong>${lang.location}:</strong> ${location}</td>
                            <td style="width: 50%; padding: 5px;"><strong>${lang.dateTime}:</strong> ${formatDateTime(dateTime)}</td>
                        </tr>
                        <tr>
                            <td style="width: 50%; padding: 5px;"><strong>${lang.conductedBy}:</strong> ${conductedBy}</td>
                            <td style="width: 50%; padding: 5px;"><strong>${lang.duration}:</strong> ${duration} minutes</td>
                        </tr>
                    </table>
                </div>
                
                <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;">${lang.attendees}</h2>
                    ${attendees.length > 0 ? `
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background-color: #2c3e50; color: white;">
                                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${lang.name}</th>
                                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${lang.contact}</th>
                                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">${lang.tradeRole}</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${attendees.map(attendee => `
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${attendee.name}</td>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${attendee.contact}</td>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${attendee.role}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : `<p>${lang.noAttendees}</p>`}
                </div>
                
                <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;">${lang.hazardsAndControls}</h2>
                    ${hazards.length > 0 ? hazards.map((hazard, index) => `
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #2c3e50;">${lang.hazardsControls} #${index + 1}</h3>
                            <div style="margin-bottom: 10px;">
                                <strong>${lang.hazardIdentification}:</strong>
                                <div style="border: 1px solid #ddd; padding: 10px; margin-top: 5px; border-radius: 4px;">${hazard.hazard}</div>
                            </div>
                            <div>
                                <strong>${lang.controlMeasures}:</strong>
                                <div style="border: 1px solid #ddd; padding: 10px; margin-top: 5px; border-radius: 4px;">${hazard.control}</div>
                            </div>
                        </div>
                    `).join('') : `<p>${lang.noHazards}</p>`}
                </div>
                
                <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;">${lang.keyDiscussion}</h2>
                    <div style="border: 1px solid #ddd; padding: 10px; min-height: 60px; border-radius: 4px;">${discussionPoints}</div>
                </div>
                
                <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;">${lang.notes}</h2>
                    <div style="border: 1px solid #ddd; padding: 10px; min-height: 60px; border-radius: 4px;">${additionalNotes}</div>
                </div>
                
                <div style="border-top: 1px solid #ddd; padding-top: 15px; margin-top: 20px; font-size: 12px; color: #666;">
                    <p><em>${lang.generatedOn} ${new Date().toLocaleString()}</em></p>
                    <p><em>${lang.generatedBy}</em></p>
                </div>
            `;
            
            pdfElement.innerHTML = html;
            document.body.appendChild(pdfElement);
            
            try {
                // Use html2canvas to capture the content
                const canvas = await html2canvas(pdfElement, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                });
                
                // Create PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Add image to PDF
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Add new pages if needed
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Download PDF
                const fileName = `Toolbox_Talk_${project.replace(/\s+/g, '_')}_${new Date().toISOString().slice(0, 10)}.pdf`;
                pdf.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                // Clean up
                document.body.removeChild(pdfElement);
            }
        }

        // Reset form
        function resetForm() {
            const lang = state.isHindi ? translations.hi : translations.en;
            if (confirm('Are you sure you want to reset the form? All data will be lost.')) {
                // Reset form fields
                document.getElementById('project').value = '';
                document.getElementById('topic').value = '';
                document.getElementById('location').value = '';
                document.getElementById('dateTime').value = '2025-11-01T16:58';
                document.getElementById('conductedBy').value = '';
                document.getElementById('duration').value = '15';
                document.getElementById('discussionPoints').value = '';
                document.getElementById('additionalNotes').value = '';
                
                // Reset attendees
                const attendeesList = document.getElementById('attendeesList');
                attendeesList.innerHTML = `
                    <div class="list-item">
                        <input type="text" placeholder="${lang.name}">
                        <input type="text" placeholder="${lang.contact}">
                        <input type="text" placeholder="${lang.tradeRole}">
                        <button class="remove-btn">×</button>
                    </div>
                `;
                
                // Reset hazards
                const hazardsList = document.getElementById('hazardsList');
                hazardsList.innerHTML = `
                    <div class="hazard-control-pair">
                        <div class="pair-header">
                            <h3>${lang.hazardsControls} #1</h3>
                            <button class="remove-btn remove-hazard">${lang.remove}</button>
                        </div>
                        <div class="form-group">
                            <label>${lang.hazardIdentification}</label>
                            <textarea placeholder="${lang.hazardIdentification}"></textarea>
                        </div>
                        <div class="form-group">
                            <label>${lang.controlMeasures}</label>
                            <textarea placeholder="${lang.controlMeasures}"></textarea>
                        </div>
                    </div>
                `;
                
                // If in preview, go back to form
                if (!document.getElementById('previewView').classList.contains('hidden')) {
                    backToForm();
                }
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>