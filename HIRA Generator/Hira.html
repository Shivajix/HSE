<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Assessment Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
            --dark: #34495e;
            --light: #ecf0f1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--primary);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out;
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: var(--dark);
            font-size: 1.2rem;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
            animation: slideUp 0.5s ease-out;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--secondary);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .risk-bands {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }
        
        .risk-band {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .risk-band:hover {
            transform: translateY(-5px);
        }
        
        .low { background-color: #d4edda; color: #155724; border-left: 5px solid #28a745; }
        .medium { background-color: #fff3cd; color: #856404; border-left: 5px solid #ffc107; }
        .high { background-color: #f8d7da; color: #721c24; border-left: 5px solid #dc3545; }
        .extreme { background-color: #e2e3e5; color: #383d41; border-left: 5px solid #6c757d; }
        
        .heatmap {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .heatmap-cell {
            padding: 15px 5px;
            text-align: center;
            border-radius: 5px;
            font-weight: 600;
            color: white;
            transition: transform 0.2s ease;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.1);
        }
        
        .heatmap-header {
            background-color: var(--primary);
            color: white;
        }
        
        .risk-1 { background-color: #2ecc71; }
        .risk-2 { background-color: #2ecc71; }
        .risk-3 { background-color: #f1c40f; }
        .risk-4 { background-color: #f1c40f; }
        .risk-6 { background-color: #f1c40f; }
        .risk-8 { background-color: #e67e22; }
        .risk-9 { background-color: #e67e22; }
        .risk-10 { background-color: #e67e22; }
        .risk-12 { background-color: #e74c3c; }
        .risk-15 { background-color: #e74c3c; }
        .risk-16 { background-color: #8e44ad; }
        .risk-20 { background-color: #8e44ad; }
        .risk-25 { background-color: #8e44ad; }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e9ecef;
        }
        
        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .residual-risks {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }
        
        .residual-risk {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            background-color: #f8f9fa;
            border-left: 5px solid var(--info);
        }
        
        .preview-section {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
        }
        
        .preview-content {
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .preview-table th, .preview-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .preview-table th {
            background-color: var(--primary);
            color: white;
        }
        
        .preview-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .risk-bands {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Risk Assessment Dashboard</h1>
            <p class="subtitle">Manage and monitor workplace safety risks</p>
        </header>
        
        <!-- Section 1: Project Details -->
        <div class="section" id="projectDetails">
            <h2 class="section-title"><i class="fas fa-clipboard-list"></i> Project Details</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="siteName">Site / Project</label>
                    <input type="text" id="siteName" placeholder="e.g., ABC Refinery – Unit 3">
                </div>
                
                <div class="form-group">
                    <label for="activityDate">Date</label>
                    <input type="date" id="activityDate">
                </div>
                
                <div class="form-group">
                    <label for="activity">Activity</label>
                    <input type="text" id="activity" placeholder="e.g., Scaffolding erection">
                </div>
                
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" placeholder="e.g., Tank Farm – Bay 2">
                </div>
                
                <div class="form-group">
                    <label for="preparedBy">Prepared by</label>
                    <input type="text" id="preparedBy" placeholder="Your name">
                </div>
                
                <div class="form-group">
                    <label for="reviewedBy">Reviewed by</label>
                    <input type="text" id="reviewedBy" placeholder="Reviewer name">
                </div>
                
                <div class="form-group">
                    <label for="approvedBy">Approved by</label>
                    <input type="text" id="approvedBy" placeholder="Approver name">
                </div>
            </div>
        </div>
        
        <!-- Section 2: Risk Bands -->
        <div class="section" id="riskBands">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> Risk Bands</h2>
            
            <div class="risk-bands">
                <div class="risk-band low">Low: 1–5</div>
                <div class="risk-band medium">Medium: 6–10</div>
                <div class="risk-band high">High: 12–15</div>
                <div class="risk-band extreme">Extreme: 16–25</div>
            </div>
            <p><em>Score = Severity x Likelihood. Adjust ranges if your company matrix differs.</em></p>
            
            <h3 style="margin-top: 20px;">Residual Risks</h3>
            <div class="residual-risks">
                <div class="residual-risk">Residual Low: <span id="residualLow">0</span></div>
                <div class="residual-risk">Residual Med: <span id="residualMed">0</span></div>
                <div class="residual-risk">Residual High: <span id="residualHigh">0</span></div>
                <div class="residual-risk">Residual Extreme: <span id="residualExtreme">0</span></div>
            </div>
        </div>
        
        <!-- Section 3: Risk Assessment Heatmap -->
        <div class="section" id="heatmap">
            <h2 class="section-title"><i class="fas fa-fire"></i> Risk Assessment Heatmap (Severity × Likelihood)</h2>
            
            <div class="heatmap">
                <div class="heatmap-cell heatmap-header"></div>
                <div class="heatmap-cell heatmap-header">L1</div>
                <div class="heatmap-cell heatmap-header">L2</div>
                <div class="heatmap-cell heatmap-header">L3</div>
                <div class="heatmap-cell heatmap-header">L4</div>
                <div class="heatmap-cell heatmap-header">L5</div>
                
                <div class="heatmap-cell heatmap-header">S1</div>
                <div class="heatmap-cell risk-1">1</div>
                <div class="heatmap-cell risk-2">2</div>
                <div class="heatmap-cell risk-3">3</div>
                <div class="heatmap-cell risk-4">4</div>
                <div class="heatmap-cell risk-5">5</div>
                
                <div class="heatmap-cell heatmap-header">S2</div>
                <div class="heatmap-cell risk-2">2</div>
                <div class="heatmap-cell risk-4">4</div>
                <div class="heatmap-cell risk-6">6</div>
                <div class="heatmap-cell risk-8">8</div>
                <div class="heatmap-cell risk-10">10</div>
                
                <div class="heatmap-cell heatmap-header">S3</div>
                <div class="heatmap-cell risk-3">3</div>
                <div class="heatmap-cell risk-6">6</div>
                <div class="heatmap-cell risk-9">9</div>
                <div class="heatmap-cell risk-12">12</div>
                <div class="heatmap-cell risk-15">15</div>
                
                <div class="heatmap-cell heatmap-header">S4</div>
                <div class="heatmap-cell risk-4">4</div>
                <div class="heatmap-cell risk-8">8</div>
                <div class="heatmap-cell risk-12">12</div>
                <div class="heatmap-cell risk-16">16</div>
                <div class="heatmap-cell risk-20">20</div>
                
                <div class="heatmap-cell heatmap-header">S5</div>
                <div class="heatmap-cell risk-5">5</div>
                <div class="heatmap-cell risk-10">10</div>
                <div class="heatmap-cell risk-15">15</div>
                <div class="heatmap-cell risk-20">20</div>
                <div class="heatmap-cell risk-25 pulse">25</div>
            </div>
        </div>
        
        <!-- Section 4: Risk Assessment Table -->
        <div class="section" id="riskAssessment">
            <h2 class="section-title"><i class="fas fa-table"></i> Risk Assessment</h2>
            
            <div class="table-container">
                <table id="riskTable">
                    <thead>
                        <tr>
                            <th>Task / Step</th>
                            <th>Hazard</th>
                            <th>Existing Controls</th>
                            <th>S × L</th>
                            <th>Initial Risk</th>
                            <th>Initial Level</th>
                            <th>Additional Controls</th>
                            <th>Residual S × L</th>
                            <th>Residual Risk</th>
                            <th>Residual Level</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="riskTableBody">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
            
            <button class="btn btn-primary" id="addRowBtn">
                <i class="fas fa-plus"></i> Add Row
            </button>
        </div>
        
        <!-- Section 5: Preview Section -->
        <div class="section preview-section" id="previewSection">
            <h2 class="section-title"><i class="fas fa-eye"></i> Preview</h2>
            
            <div class="preview-content" id="previewContent">
                <div id="previewProjectDetails">
                    <h3>Project Details</h3>
                    <p><strong>Site/Project:</strong> <span id="previewSiteName">Not specified</span></p>
                    <p><strong>Date:</strong> <span id="previewDate">Not specified</span></p>
                    <p><strong>Activity:</strong> <span id="previewActivity">Not specified</span></p>
                    <p><strong>Location:</strong> <span id="previewLocation">Not specified</span></p>
                    <p><strong>Prepared by:</strong> <span id="previewPreparedBy">Not specified</span></p>
                    <p><strong>Reviewed by:</strong> <span id="previewReviewedBy">Not specified</span></p>
                    <p><strong>Approved by:</strong> <span id="previewApprovedBy">Not specified</span></p>
                </div>
                
                <div id="previewRiskAssessment" style="margin-top: 20px;">
                    <h3>Risk Assessment</h3>
                    <div class="table-container">
                        <table class="preview-table" id="previewRiskTable">
                            <thead>
                                <tr>
                                    <th>Task / Step</th>
                                    <th>Hazard</th>
                                    <th>Existing Controls</th>
                                    <th>S × L</th>
                                    <th>Initial Risk</th>
                                    <th>Initial Level</th>
                                    <th>Additional Controls</th>
                                    <th>Residual S × L</th>
                                    <th>Residual Risk</th>
                                    <th>Residual Level</th>
                                </tr>
                            </thead>
                            <tbody id="previewRiskTableBody">
                                <!-- Preview rows will be added dynamically -->
                                <tr>
                                    <td colspan="10" style="text-align: center;">No risk assessments added yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="previewResidualSummary" style="margin-top: 20px;">
                    <h3>Residual Risk Summary</h3>
                    <p><strong>Residual Low:</strong> <span id="previewResidualLow">0</span></p>
                    <p><strong>Residual Medium:</strong> <span id="previewResidualMed">0</span></p>
                    <p><strong>Residual High:</strong> <span id="previewResidualHigh">0</span></p>
                    <p><strong>Residual Extreme:</strong> <span id="previewResidualExtreme">0</span></p>
                </div>
            </div>
        </div>
        
        <!-- Section 6: Action Buttons -->
        <div class="actions">
            <button class="btn btn-success" id="downloadBtn">
                <i class="fas fa-file-pdf"></i> Download PDF
            </button>
            <button class="btn btn-warning" id="resetBtn">
                <i class="fas fa-sync-alt"></i> Reset Page
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const riskTableBody = document.getElementById('riskTableBody');
            const addRowBtn = document.getElementById('addRowBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const resetBtn = document.getElementById('resetBtn');
            const previewRiskTableBody = document.getElementById('previewRiskTableBody');
            
            // Form inputs
            const siteNameInput = document.getElementById('siteName');
            const activityDateInput = document.getElementById('activityDate');
            const activityInput = document.getElementById('activity');
            const locationInput = document.getElementById('location');
            const preparedByInput = document.getElementById('preparedBy');
            const reviewedByInput = document.getElementById('reviewedBy');
            const approvedByInput = document.getElementById('approvedBy');
            
            // Preview elements
            const previewSiteName = document.getElementById('previewSiteName');
            const previewDate = document.getElementById('previewDate');
            const previewActivity = document.getElementById('previewActivity');
            const previewLocation = document.getElementById('previewLocation');
            const previewPreparedBy = document.getElementById('previewPreparedBy');
            const previewReviewedBy = document.getElementById('previewReviewedBy');
            const previewApprovedBy = document.getElementById('previewApprovedBy');
            const previewResidualLow = document.getElementById('previewResidualLow');
            const previewResidualMed = document.getElementById('previewResidualMed');
            const previewResidualHigh = document.getElementById('previewResidualHigh');
            const previewResidualExtreme = document.getElementById('previewResidualExtreme');
            
            let rowCount = 0;
            
            // Add event listeners to form inputs to update preview in real-time
            siteNameInput.addEventListener('input', updatePreview);
            activityDateInput.addEventListener('input', updatePreview);
            activityInput.addEventListener('input', updatePreview);
            locationInput.addEventListener('input', updatePreview);
            preparedByInput.addEventListener('input', updatePreview);
            reviewedByInput.addEventListener('input', updatePreview);
            approvedByInput.addEventListener('input', updatePreview);
            
            // Add Row Functionality
            addRowBtn.addEventListener('click', function() {
                addNewRow();
                updatePreview();
            });
            
            // Download PDF Functionality
            downloadBtn.addEventListener('click', function() {
                generatePDF();
            });
            
            // Reset Page Functionality
            resetBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to reset the page? All data will be lost.')) {
                    resetPage();
                }
            });
            
            // Add a new row to the table
            function addNewRow() {
                rowCount++;
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" class="task-step" placeholder="Task description"></td>
                    <td><input type="text" class="hazard" placeholder="Hazard description"></td>
                    <td><textarea class="existing-controls" placeholder="Existing controls"></textarea></td>
                    <td>
                        <select class="severity">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3" selected>3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select> × 
                        <select class="likelihood">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3" selected>3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </td>
                    <td class="initial-risk">9</td>
                    <td class="initial-level">Medium</td>
                    <td><textarea class="additional-controls" placeholder="Additional controls"></textarea></td>
                    <td>
                        <select class="residual-severity">
                            <option value="1">1</option>
                            <option value="2" selected>2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select> × 
                        <select class="residual-likelihood">
                            <option value="1">1</option>
                            <option value="2" selected>2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </td>
                    <td class="residual-risk">4</td>
                    <td class="residual-level">Low</td>
                    <td><button class="delete-btn" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                `;
                
                riskTableBody.appendChild(newRow);
                
                // Add event listeners to the new row
                const severitySelect = newRow.querySelector('.severity');
                const likelihoodSelect = newRow.querySelector('.likelihood');
                const residualSeveritySelect = newRow.querySelector('.residual-severity');
                const residualLikelihoodSelect = newRow.querySelector('.residual-likelihood');
                const taskStepInput = newRow.querySelector('.task-step');
                const hazardInput = newRow.querySelector('.hazard');
                const existingControlsInput = newRow.querySelector('.existing-controls');
                const additionalControlsInput = newRow.querySelector('.additional-controls');
                
                severitySelect.addEventListener('change', updateRiskValues);
                likelihoodSelect.addEventListener('change', updateRiskValues);
                residualSeveritySelect.addEventListener('change', updateRiskValues);
                residualLikelihoodSelect.addEventListener('change', updateRiskValues);
                taskStepInput.addEventListener('input', updatePreview);
                hazardInput.addEventListener('input', updatePreview);
                existingControlsInput.addEventListener('input', updatePreview);
                additionalControlsInput.addEventListener('input', updatePreview);
                
                updateResidualCounts();
            }
            
            // Update risk values when severity or likelihood changes
            function updateRiskValues(event) {
                const row = event.target.closest('tr');
                const severity = parseInt(row.querySelector('.severity').value);
                const likelihood = parseInt(row.querySelector('.likelihood').value);
                const residualSeverity = parseInt(row.querySelector('.residual-severity').value);
                const residualLikelihood = parseInt(row.querySelector('.residual-likelihood').value);
                
                const initialRisk = severity * likelihood;
                const residualRisk = residualSeverity * residualLikelihood;
                
                row.querySelector('.initial-risk').textContent = initialRisk;
                row.querySelector('.residual-risk').textContent = residualRisk;
                
                row.querySelector('.initial-level').textContent = getRiskLevel(initialRisk);
                row.querySelector('.residual-level').textContent = getRiskLevel(residualRisk);
                
                updateResidualCounts();
                updatePreview();
            }
            
            // Delete a row
            window.deleteRow = function(button) {
                const row = button.closest('tr');
                row.remove();
                updateResidualCounts();
                updatePreview();
            }
            
            // Get risk level based on score
            function getRiskLevel(score) {
                if (score <= 5) return 'Low';
                if (score <= 10) return 'Medium';
                if (score <= 15) return 'High';
                return 'Extreme';
            }
            
            // Update residual risk counts
            function updateResidualCounts() {
                const rows = riskTableBody.querySelectorAll('tr');
                let lowCount = 0, medCount = 0, highCount = 0, extremeCount = 0;
                
                rows.forEach(row => {
                    const residualRisk = parseInt(row.querySelector('.residual-risk').textContent);
                    const level = getRiskLevel(residualRisk);
                    
                    switch(level) {
                        case 'Low': lowCount++; break;
                        case 'Medium': medCount++; break;
                        case 'High': highCount++; break;
                        case 'Extreme': extremeCount++; break;
                    }
                });
                
                document.getElementById('residualLow').textContent = lowCount;
                document.getElementById('residualMed').textContent = medCount;
                document.getElementById('residualHigh').textContent = highCount;
                document.getElementById('residualExtreme').textContent = extremeCount;
                
                // Update preview residual counts
                previewResidualLow.textContent = lowCount;
                previewResidualMed.textContent = medCount;
                previewResidualHigh.textContent = highCount;
                previewResidualExtreme.textContent = extremeCount;
            }
            
            // Update preview section
            function updatePreview() {
                // Update project details
                previewSiteName.textContent = siteNameInput.value || 'Not specified';
                previewDate.textContent = activityDateInput.value || 'Not specified';
                previewActivity.textContent = activityInput.value || 'Not specified';
                previewLocation.textContent = locationInput.value || 'Not specified';
                previewPreparedBy.textContent = preparedByInput.value || 'Not specified';
                previewReviewedBy.textContent = reviewedByInput.value || 'Not specified';
                previewApprovedBy.textContent = approvedByInput.value || 'Not specified';
                
                // Update risk assessment table
                const rows = riskTableBody.querySelectorAll('tr');
                let tableHTML = '';
                
                if (rows.length === 0) {
                    tableHTML = '<tr><td colspan="10" style="text-align: center;">No risk assessments added yet</td></tr>';
                } else {
                    rows.forEach(row => {
                        const taskStep = row.querySelector('.task-step').value || '';
                        const hazard = row.querySelector('.hazard').value || '';
                        const existingControls = row.querySelector('.existing-controls').value || '';
                        const severity = row.querySelector('.severity').value;
                        const likelihood = row.querySelector('.likelihood').value;
                        const initialRisk = row.querySelector('.initial-risk').textContent;
                        const initialLevel = row.querySelector('.initial-level').textContent;
                        const additionalControls = row.querySelector('.additional-controls').value || '';
                        const residualSeverity = row.querySelector('.residual-severity').value;
                        const residualLikelihood = row.querySelector('.residual-likelihood').value;
                        const residualRisk = row.querySelector('.residual-risk').textContent;
                        const residualLevel = row.querySelector('.residual-level').textContent;
                        
                        tableHTML += `
                            <tr>
                                <td>${taskStep}</td>
                                <td>${hazard}</td>
                                <td>${existingControls}</td>
                                <td>${severity} × ${likelihood}</td>
                                <td>${initialRisk}</td>
                                <td>${initialLevel}</td>
                                <td>${additionalControls}</td>
                                <td>${residualSeverity} × ${residualLikelihood}</td>
                                <td>${residualRisk}</td>
                                <td>${residualLevel}</td>
                            </tr>
                        `;
                    });
                }
                
                previewRiskTableBody.innerHTML = tableHTML;
            }
            
            // Generate PDF
            function generatePDF() {
                const previewContent = document.getElementById('previewContent');
                
                // Use html2canvas and jsPDF to generate PDF
                html2canvas(previewContent).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                    const imgWidth = 210;
                    const pageHeight = 295;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    pdf.save('risk-assessment.pdf');
                });
            }
            
            // Reset page
            function resetPage() {
                siteNameInput.value = '';
                activityDateInput.value = '';
                activityInput.value = '';
                locationInput.value = '';
                preparedByInput.value = '';
                reviewedByInput.value = '';
                approvedByInput.value = '';
                
                riskTableBody.innerHTML = '';
                rowCount = 0;
                
                document.getElementById('residualLow').textContent = '0';
                document.getElementById('residualMed').textContent = '0';
                document.getElementById('residualHigh').textContent = '0';
                document.getElementById('residualExtreme').textContent = '0';
                
                updatePreview();
            }
            
            // Add sample data on load
            addSampleData();
            
            function addSampleData() {
                // Set form values
                siteNameInput.value = 'ABC Refinery - Unit 3';
                activityDateInput.value = '2023-10-15';
                activityInput.value = 'Hot Work';
                locationInput.value = 'Tank Farm - Bay 2';
                preparedByInput.value = 'John Safety';
                reviewedByInput.value = 'Jane Manager';
                approvedByInput.value = 'Robert Director';
                
                // Add sample rows
                addNewRow();
                const firstRow = riskTableBody.querySelector('tr');
                firstRow.querySelector('.task-step').value = 'Welding on pipeline';
                firstRow.querySelector('.hazard').value = 'Fire/Explosion';
                firstRow.querySelector('.existing-controls').value = 'Hot work permit, Fire extinguishers';
                firstRow.querySelector('.severity').value = '4';
                firstRow.querySelector('.likelihood').value = '3';
                firstRow.querySelector('.additional-controls').value = 'Additional fire blankets';
                firstRow.querySelector('.residual-severity').value = '3';
                firstRow.querySelector('.residual-likelihood').value = '2';
                
                // Trigger update to calculate risks
                const event = new Event('change');
                firstRow.querySelector('.severity').dispatchEvent(event);
                
                addNewRow();
                const secondRow = riskTableBody.querySelector('tr:last-child');
                secondRow.querySelector('.task-step').value = 'Working on scaffold';
                secondRow.querySelector('.hazard').value = 'Fall from height';
                secondRow.querySelector('.existing-controls').value = 'Harness, guardrails';
                secondRow.querySelector('.severity').value = '5';
                secondRow.querySelector('.likelihood').value = '3';
                secondRow.querySelector('.additional-controls').value = 'Additional anchor points';
                secondRow.querySelector('.residual-severity').value = '3';
                secondRow.querySelector('.residual-likelihood').value = '2';
                
                // Trigger update to calculate risks
                secondRow.querySelector('.severity').dispatchEvent(event);
                
                // Update preview
                updatePreview();
            }
        });
    </script>
</body>
</html>